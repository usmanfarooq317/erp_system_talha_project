{"ast":null,"code":"import _objectSpread from\"/home/usman/Desktop/erp_system_talha_project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const STR={en:{addProduct:'Add Product',addCustomer:'Add Customer',paidNow:'Paid Now',remaining:'Remaining',previousPending:'Previous Pending',savePrint:'Save & Print',products:'Products',customers:'Customers',purchases:'Purchases',sales:'Sales',reports:'Reports',debits:'Debits',settings:'Settings',login:'Welcome Back',username:'Username',password:'Password',loginBtn:'Login',vendorName:'Vendor Name',modeOfPayment:'Mode of Payment',cash:'Cash',card:'Card',cheque:'Cheque',online:'Online',availableproducts:'Available Products',recycleBin:'Recycle Bin'},ur:{addProduct:'مصنوع شامل کریں',addCustomer:'کسٹمر شامل کریں',paidNow:'ادائیگی',remaining:'بقیہ',previousPending:'پچھلا بقایا',savePrint:'محفوظ کریں اور پرنٹ کریں',products:'پراڈکٹس',customers:'کسٹمرز',purchases:'خریداری',sales:'فروخت',reports:'رپورٹس',debits:'ادائیگیاں',settings:'سیٹنگز',login:'لاگ ان کریں',username:'یوزر',password:'پاس ورڈ',loginBtn:'لاگ ان',vendorName:'سپلائر کا نام',modeOfPayment:'ادائیگی کا طریقہ',cash:'نقد',card:'کارڈ',cheque:'چیک',online:'آن لائن',availableproducts:'دستیاب مصنوعات',recycleBin:'ری سائیکل بن',login:'خوش آمدید'}};function App(){const[lang,setLang]=useState(localStorage.getItem('erp_lang')||'en');const[route,setRoute]=useState('dashboard');const[user,setUser]=useState(null);const[logo,setLogo]=useState(localStorage.getItem('erp_logo')||'');function t(k){return STR[lang][k]||k;}useEffect(()=>{if(user)setRoute('dashboard');},[user]);if(!user){return/*#__PURE__*/_jsx(Login,{onSuccess:u=>{setUser(u);},logo:logo,t:t,setLang:setLang,lang:lang});}const titleMap={dashboard:'Dashboard',products:t('products'),sales:t('sales'),purchases:t('purchases'),reports:t('reports'),debits:t('debits'),settings:t('settings'),RecycleBin:t('Recycle Bin')};const currentTitle=titleMap[route]||'Recycle Bin';return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen flex bg-slate-100 text-slate-900\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"w-64 bg-slate-950 text-slate-50 flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-5 flex items-center gap-3 border-b border-slate-800\",children:[logo?/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"DP\",className:\"h-12 w-12 rounded-full object-cover ring-2 ring-cyan-400 shadow-md\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-12 w-12 rounded-full bg-slate-800 flex items-center justify-center text-sm font-semibold\",children:\"Recycle Bin\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-white\",children:\"Ethehad Traders\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-cyan-400\",children:\"ET & Co\"})]})]}),/*#__PURE__*/_jsx(\"nav\",{className:\"flex-1 px-2 py-4 space-y-1\",children:[['dashboard','Dashboard'],['products',t('products')],['sales',t('sales')],['purchases',t('purchases')],['reports',t('reports')],['debits',t('debits')],['settings',t('settings')],['recycleBin',t('Recycle Bin')]].map(_ref=>{let[value,label]=_ref;return/*#__PURE__*/_jsx(\"button\",{onClick:()=>setRoute(value),className:\"w-full flex items-center px-3 py-2 rounded-lg text-sm text-left transition\\n                \".concat(route===value?'bg-gradient-to-r from-cyan-500/20 via-sky-500/10 to-transparent text-white border-l-4 border-cyan-400':'text-slate-300 hover:bg-slate-800/60'),children:label},value);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-4 border-t border-slate-800 text-xs text-slate-400 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:user===null||user===void 0?void 0:user.username}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"select\",{value:lang,onChange:e=>{const l=e.target.value;setLang(l);localStorage.setItem('erp_lang',l);},className:\"bg-slate-900 border border-slate-700 rounded px-1 py-0.5 text-xs\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"en\",children:\"EN\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ur\",children:\"UR\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setUser(null);setRoute('login');},className:\"text-red-400 hover:text-red-300\",children:\"Logout\"})]})]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"flex-1 relative overflow-hidden\",children:[logo&&/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"background\",className:\"pointer-events-none select-none absolute inset-0 w-full h-full object-cover opacity-10\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative h-full p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 bg-white/80 backdrop-blur-xl shadow-lg rounded-2xl px-6 py-4\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg font-semibold text-slate-800\",children:currentTitle})}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10\",children:[route==='dashboard'&&/*#__PURE__*/_jsx(Dashboard,{t:t}),route==='products'&&/*#__PURE__*/_jsx(Products,{t:t}),route==='sales'&&/*#__PURE__*/_jsx(Sales,{t:t}),route==='purchases'&&/*#__PURE__*/_jsx(Purchases,{t:t}),route==='reports'&&/*#__PURE__*/_jsx(Reports,{t:t}),route==='debits'&&/*#__PURE__*/_jsx(Debits,{t:t}),route==='recycleBin'&&/*#__PURE__*/_jsx(RecycleBin,{t:t}),route==='settings'&&/*#__PURE__*/_jsx(Settings,{t:t,onLogoChange:l=>{setLogo(l);localStorage.setItem('erp_logo',l);}})]})]})]})]});}function Header(_ref2){let{setRoute,setUser,logo,setLogo,lang,setLang,t}=_ref2;return/*#__PURE__*/_jsx(\"header\",{className:\"bg-white shadow mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto px-2 sm:px-4 md:px-6 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[logo?/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"logo\",className:\"h-10 w-10 object-contain\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-10 w-10 bg-sky-100 rounded flex items-center justify-center text-sky-600\",children:\"Logo\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg md:text-xl font-semibold text-sky-600\",children:\"ERP\"})]}),/*#__PURE__*/_jsxs(\"nav\",{className:\"flex flex-wrap items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('dashboard'),children:t('Dashboard')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('products'),children:t('products')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('sales'),children:t('sales')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('purchases'),children:t('purchases')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('reports'),children:t('reports')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('debits'),children:t('debits')}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\",onClick:()=>setRoute('settings'),children:t('settings')}),/*#__PURE__*/_jsxs(\"select\",{value:lang,onChange:e=>{setLang(e.target.value);localStorage.setItem('erp_lang',e.target.value);},className:\"border rounded px-2 py-1 text-xs sm:text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"en\",children:\"EN\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ur\",children:\"UR\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 rounded-md bg-sky-600 text-white hover:bg-sky-700 transition text-xs sm:text-sm\",onClick:()=>{setUser(null);localStorage.removeItem('erp_lang');},children:t('login')})]})]})});}//fuction login\nfunction Login(_ref3){let{onSuccess,logo,t,setLang,lang}=_ref3;const[u,setU]=useState('admin');const[p,setP]=useState('admin');const[err,setErr]=useState('');async function submit(e){e.preventDefault();try{const res=await fetch('http://localhost:4000/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});if(!res.ok)throw new Error('login failed');const j=await res.json();onSuccess(j.user);}catch(err){setErr('Wrong Password or Username');}}return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center py-12\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-md bg-white rounded-xl shadow-md p-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center mb-4\",children:logo?/*#__PURE__*/_jsx(\"img\",{src:logo,className:\"h-24 w-24 object-contain\",alt:\"logo\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-24 w-24 bg-sky-100 rounded-full flex items-center justify-center text-sky-600\",children:\"Logo\"})}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-center text-xl font-semibold text-gray-700 mb-4\",children:t('login')}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:submit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:t('username'),className:\"w-full px-4 py-2 border rounded-md focus:outline-sky-300\",value:u,onChange:e=>setU(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:t('password'),className:\"w-full px-4 py-2 border rounded-md focus:outline-sky-300\",value:p,onChange:e=>setP(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 items-center\",children:[/*#__PURE__*/_jsxs(\"select\",{value:lang,onChange:e=>{setLang(e.target.value);localStorage.setItem('erp_lang',e.target.value);},className:\"border p-1 rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"en\",children:\"EN\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ur\",children:\"UR\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition\",children:t('loginBtn')})]})]}),err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 mt-3\",children:err})]})});}/* Dashboard */function Dashboard(_ref4){let{t}=_ref4;const[activeTab,setActiveTab]=useState(\"customers\");// 'customers' | 'stock'\nconst[sales,setSales]=useState([]);const[selectedCustomerName,setSelectedCustomerName]=useState(\"\");const[loading,setLoading]=useState(false);const[err,setErr]=useState(\"\");const logoUrl=localStorage.getItem(\"erp_logo\")||\"\";// Stock-related state\nconst[stock,setStock]=useState([]);const[movements,setMovements]=useState([]);const[stockLoading,setStockLoading]=useState(false);const[stockErr,setStockErr]=useState(\"\");// Initial load\nuseEffect(()=>{loadSales();loadStockData();},[]);// ---------------- SALES LOADING ----------------\nasync function loadSales(){try{setLoading(true);setErr(\"\");const res=await fetch(\"http://localhost:4000/api/sales\");const j=await res.json();if(!j.ok){setErr(j.message||\"Failed to load sales\");return;}setSales(j.sales||[]);}catch(e){console.error(e);setErr(\"Failed to load sales\");}finally{setLoading(false);}}// --------------- STOCK LOADING (from purchases + sales) ---------------\nasync function loadStockData(){try{setStockLoading(true);setStockErr(\"\");const[pRes,sRes]=await Promise.all([fetch(\"http://localhost:4000/api/purchases\"),fetch(\"http://localhost:4000/api/sales\")]);const[pJson,sJson]=await Promise.all([pRes.json(),sRes.json()]);if(!pJson.ok)throw new Error(pJson.message||\"Failed to load purchases\");if(!sJson.ok)throw new Error(sJson.message||\"Failed to load sales\");const purchases=pJson.purchases||[];const salesData=sJson.sales||[];const mvts=[];// Purchases → increase stock\npurchases.forEach(p=>{(p.products||p.lines||[]).forEach(line=>{mvts.push({date:p.date,type:\"Purchase\",productName:line.productName||\"\",bagWeight:Number(line.weight||0),bagsDelta:Number(line.qty||line.quantity||0)});});});// Sales → decrease stock\nsalesData.forEach(s=>{(s.products||s.lines||[]).forEach(line=>{mvts.push({date:s.date,type:\"Sale\",productName:line.productName||\"\",bagWeight:Number(line.weight||0),bagsDelta:Number(line.quantity||line.qty||0)});});});setMovements(mvts);setStock(mvts);// optional, if you use `stock` elsewhere\n}catch(e){console.error(e);setStockErr(e.message||\"Failed to load stock data\");}finally{setStockLoading(false);}}// OLD stock loader hitting /api/stock, /api/stock/movements (keep if you really need it)\nasync function loadStock(){try{setStockLoading(true);setStockErr(\"\");const[resStock,resMov]=await Promise.all([fetch(\"http://localhost:4000/api/stock\"),fetch(\"http://localhost:4000/api/stock/movements\")]);const jStock=await resStock.json();const jMov=await resMov.json();if(!jStock.ok)throw new Error(jStock.message||\"Failed stock\");if(!jMov.ok)throw new Error(jMov.message||\"Failed movements\");setStock(jStock.stock||[]);setMovements(jMov.movements||[]);}catch(e){console.error(e);setStockErr(\"Failed to load stock info\");}finally{setStockLoading(false);}}// ---------------- CUSTOMER GROUPING (latest pending only) ----------------\nconst customerGroup=new Map();(sales||[]).forEach(s=>{const name=s.customerName||\"Unknown\";if(!customerGroup.has(name)){customerGroup.set(name,{customerName:name,invoices:[],totalGrand:0,totalPaid:0});}const entry=customerGroup.get(name);entry.invoices.push(s);entry.totalGrand+=Number(s.grandTotal||0);entry.totalPaid+=Number(s.paidNow||0);});const customersWithPending=Array.from(customerGroup.values()).map(entry=>{// sort by date to find LAST invoice\nconst sortedInvoices=[...entry.invoices].sort((a,b)=>new Date(a.date||0)-new Date(b.date||0));const last=sortedInvoices[sortedInvoices.length-1];const latestPending=Number((last===null||last===void 0?void 0:last.pending)||0);return _objectSpread(_objectSpread({},entry),{},{invoices:sortedInvoices,totalPending:latestPending// only latest remaining counts\n});}).filter(entry=>entry.totalPending>0).sort((a,b)=>b.totalPending-a.totalPending);const selectedCustomer=customersWithPending.find(c=>c.customerName===selectedCustomerName)||null;// === STOCK SUMMARY (per product + bag weight) ===\nconst stockSummaryMap=new Map();(movements||[]).forEach(mv=>{const name=mv.productName||'';const bagWt=Number(mv.bagWeight||mv.bagWt||0);if(!name||!bagWt)return;const key=\"\".concat(name,\"||\").concat(bagWt);if(!stockSummaryMap.has(key)){stockSummaryMap.set(key,{productName:name,bagWeight:bagWt,purchased:0,sold:0});}const row=stockSummaryMap.get(key);const qty=Number(mv.bagsDelta||mv.qty||mv.bags||0);if(mv.type==='Purchase'){row.purchased+=Math.abs(qty);}else if(mv.type==='Sale'){row.sold+=Math.abs(qty);}});// rows by product + bag weight\nconst stockSummaryRows=Array.from(stockSummaryMap.values()).map(r=>_objectSpread(_objectSpread({},r),{},{available:r.purchased-r.sold})).sort((a,b)=>a.productName.localeCompare(b.productName)||a.bagWeight-b.bagWeight);const maxStockValue=stockSummaryRows.length===0?1:Math.max(...stockSummaryRows.map(r=>Math.max(r.purchased,r.sold,r.available)),1);// === AGGREGATE BY PRODUCT (ignore bag weight) ===\nconst productTotalsMap=new Map();stockSummaryRows.forEach(r=>{if(!productTotalsMap.has(r.productName)){productTotalsMap.set(r.productName,{productName:r.productName,purchased:0,sold:0,available:0});}const entry=productTotalsMap.get(r.productName);entry.purchased+=r.purchased;entry.sold+=r.sold;entry.available+=r.available;});const productTotals=Array.from(productTotalsMap.values()).sort((a,b)=>b.available-a.available);const maxProductValue=productTotals.length===0?1:Math.max(...productTotals.map(p=>Math.max(p.purchased,p.sold,p.available)),1);const totalAvailableBags=productTotals.reduce((sum,p)=>sum+Math.max(p.available,0),0);const totalProductsInStock=productTotals.filter(p=>p.available>0).length;// simple low-stock rule: available > 0 and <= 20 bags\nconst lowStockCount=productTotals.filter(p=>p.available>0&&p.available<=20).length;// show only top N in the big bars (to avoid mess)\nconst topProductsForBars=productTotals.slice(0,8);// ================= STOCK SUMMARY (per product + bag weight) =================   \n// ---------------- PRINT / DELETE HELPERS ----------------\nfunction printInvoiceForRecord(record){if(!record)return;const dateTime=record.date?new Date(record.date).toLocaleString():new Date().toLocaleString();const items=record.products||record.lines||[];const customerTotal=Number(record.customerTotal||0);const previousPending=Number(record.previousPending||0);const grandTotal=Number(record.grandTotal||0);const paidNow=Number(record.paidNow||0);const remaining=Number(record.pending||0);const html=\"\\n      <html><body>\\n      <img src='\".concat(logoUrl,\"' style='display:block;margin:0 auto;width:180px;opacity:0.9' />\\n      <h2 style='text-align:center'>Invoice</h2>\\n      <div>Customer: \").concat(record.customerName||'',\"</div>\\n      <div>Date &amp; Time: \").concat(dateTime,\"</div>\\n      <table border='1' style='width:100%;border-collapse:collapse'>\\n        <tr>\\n          <th>#</th>\\n          <th>Product</th>\\n          <th>Qty</th>\\n          <th>Weight</th>\\n          <th>Price</th>\\n          <th>Line Total</th>\\n        </tr>\\n        \").concat(items.map((it,i)=>\"\\n          <tr>\\n            <td>\".concat(i+1,\"</td>\\n            <td>\").concat(it.productName||'',\"</td>\\n            <td>\").concat(it.quantity||it.qty||0,\"</td>\\n            <td>\").concat(it.weight||0,\"</td>\\n            <td>\").concat(it.pricePerKg||it.price||0,\"</td>\\n            <td>\").concat(Number(it.lineTotal||Number(it.quantity||it.qty||0)*Number(it.pricePerKg||it.price||0)).toFixed(2),\"</td>\\n          </tr>\")).join(''),\"\\n      </table>\\n      <h3>Customer Total: \").concat(customerTotal.toFixed(2),\"</h3>\\n      <div>Previous Pending: \").concat(previousPending.toFixed(2),\"</div>\\n      <div>Grand Total: \").concat(grandTotal.toFixed(2),\"</div>\\n      <div>Paid: \").concat(paidNow.toFixed(2),\"</div>\\n      <div>Remaining: \").concat(remaining.toFixed(2),\"</div>\\n      </body></html>\\n    \");const w=window.open(\"\",\"_blank\");w.document.write(html);w.document.close();setTimeout(()=>w.print(),300);}async function deleteSaleFromDashboard(id){if(!window.confirm(\"Delete this sale?\"))return;try{const res=await fetch(\"http://localhost:4000/api/sales/\".concat(id),{method:\"DELETE\"});const j=await res.json();if(!j.ok){alert(j.message||\"Failed to delete sale\");return;}setSales(prev=>prev.filter(s=>s.id!==id));}catch(e){console.error(e);alert(\"Error deleting sale\");}}// ---------------- JSX ----------------\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:\"Dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex mb-4 gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveTab(\"customers\"),className:\"px-4 py-2 rounded text-sm \"+(activeTab===\"customers\"?\"bg-sky-600 text-white\":\"bg-white text-sky-700 border\"),children:\"Customer Records\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setActiveTab(\"stock\"),className:\"px-4 py-2 rounded text-sm \"+(activeTab===\"stock\"?\"bg-sky-600 text-white\":\"bg-white text-sky-700 border\"),children:\"Stocks Updates\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(activeTab===\"customers\"){loadSales();}else if(activeTab===\"stock\"){loadStockData();// use stockData version\n}},className:\"ml-auto px-3 py-2 text-xs bg-gray-100 border rounded hover:bg-gray-200\",children:\"Refresh\"})]}),activeTab===\"customers\"&&loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-2\",children:\"Loading sales\\u2026\"}),activeTab===\"customers\"&&err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600 mb-2\",children:err}),activeTab===\"stock\"&&stockLoading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-2\",children:\"Loading stock\\u2026\"}),activeTab===\"stock\"&&stockErr&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600 mb-2\",children:stockErr}),activeTab===\"customers\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow lg:col-span-1\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2 text-sm\",children:\"Customers with Remaining Amount\"}),customersWithPending.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No customers with pending amounts.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Customer\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Pending\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:customersWithPending.map(c=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t cursor-pointer \"+(c.customerName===selectedCustomerName?\"bg-sky-50\":\"\"),onClick:()=>setSelectedCustomerName(c.customerName),children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:c.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:c.totalPending.toFixed(2)})]},c.customerName))})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded shadow lg:col-span-2\",children:!selectedCustomer?/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Select a customer on the left to see full record of their purchases, paid amounts, and remaining balance.\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between mb-3 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:selectedCustomer.customerName}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-gray-500 text-xs\",children:[\"Total Pending:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedCustomer.totalPending.toFixed(2)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-right space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Total Grand:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedCustomer.totalGrand.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Total Paid:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedCustomer.totalPaid.toFixed(2)})]})]})]}),selectedCustomer.invoices.map(inv=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded mb-3 p-3 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between mb-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Date: \"}),inv.date]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Grand: \"}),inv.grandTotal,\" \\xA0 | \\xA0\",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Paid: \"}),inv.paidNow,\" \\xA0 | \\xA0\",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Remaining: \"}),inv.pending]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-[11px] border mt-1\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Weight\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Line Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:(inv.products||inv.lines||[]).map((p,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:idx+1}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.quantity||p.qty}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.weight}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.pricePerKg||p.price}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.lineTotal})]},idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex justify-end gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>printInvoiceForRecord(inv),className:\"px-2 py-1 bg-indigo-600 text-white rounded\",children:\"Print Invoice\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteSaleFromDashboard(inv.id),className:\"px-2 py-1 bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1 Delete\"})]})]},inv.id))]})})]}),activeTab==='stock'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-base\",children:\"Stock Updates\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadStockData,className:\"ml-auto px-3 py-1 text-xs border rounded hover:bg-gray-50\",children:\"Refresh\"})]}),stockLoading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-2\",children:\"Loading stock\\u2026\"}),stockErr&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-600 mb-2\",children:stockErr}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg px-3 py-2 bg-sky-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-[11px] text-sky-700 uppercase\",children:\"Total Products in Stock\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:totalProductsInStock})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg px-3 py-2 bg-emerald-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-[11px] text-emerald-700 uppercase\",children:\"Total Available Bags\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:totalAvailableBags})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg px-3 py-2 bg-amber-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-[11px] text-amber-700 uppercase\",children:\"Low Stock Items (\\u2264 20 bags)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:lowStockCount})]})]}),stockSummaryRows.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No stock calculated yet. Add some purchases / sales first.\"}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-sm mb-2\",children:\"Available Stock (by product & bag weight)\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs mb-4\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Bag Wt\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Purchased\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Sold\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Available\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:stockSummaryRows.map(r=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:r.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:r.bagWeight}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:r.purchased}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:r.sold}),/*#__PURE__*/_jsx(\"td\",{className:'p-2 text-right '+(r.available<0?'text-red-600 font-semibold':''),children:r.available})]},\"\".concat(r.productName,\"-\").concat(r.bagWeight)))})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-sm mb-2\",children:\"Stock Overview by Product (bags)\"}),topProductsForBars.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No products with stock yet.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3\",children:topProductsForBars.map(p=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-[11px] mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:p.productName}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Available: \",p.available]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"h-3 bg-gray-100 rounded overflow-hidden flex\",children:[/*#__PURE__*/_jsx(\"div\",{style:{width:p.purchased/maxProductValue*100+'%'},className:\"bg-blue-500\",title:\"Purchased: \".concat(p.purchased)}),/*#__PURE__*/_jsx(\"div\",{style:{width:p.sold/maxProductValue*100+'%'},className:\"bg-red-400\",title:\"Sold: \".concat(p.sold)}),/*#__PURE__*/_jsx(\"div\",{style:{width:Math.max(p.available,0)/maxProductValue*100+'%'},className:\"bg-green-500\",title:\"Available: \".concat(p.available)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-[10px] text-gray-500 mt-0.5\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Purchased: \",p.purchased]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Sold: \",p.sold]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Available: \",p.available]})]})]},\"prod-bar-\".concat(p.productName)))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 text-[10px] text-gray-500 mt-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 bg-blue-500 inline-block rounded-sm\"}),' ',\"Purchased\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 bg-red-400 inline-block rounded-sm\"}),' ',\"Sold\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-3 h-3 bg-green-500 inline-block rounded-sm\"}),' ',\"Available\"]})]})]})]})})]})]});}/* Products */function Products(_ref5){let{t}=_ref5;const[name,setName]=useState('');const[quantity,setQuantity]=useState(1);const[list,setList]=useState([]);useEffect(()=>{fetch('http://localhost:4000/5api/products').then(r=>r.json()).then(j=>setList(j.products||[])).catch(()=>{});},[]);async function add(){if(!name)return alert('Enter product name');const res=await fetch('http://localhost:4000/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,quantity})});const j=await res.json();if(j.ok){setList(prev=>[...prev,j.prod]);setName('');setQuantity(1);}}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:t('products')}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded shadow mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Product name\",value:name,onChange:e=>setName(e.target.value),className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:quantity,onChange:e=>setQuantity(Number(e.target.value)),className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"button\",{onClick:add,className:\"bg-sky-600 text-white px-4 rounded hover:bg-sky-700 transition\",children:t('addProduct')})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"Available Products\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Qty\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:list.map(p=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:p.id}),/*#__PURE__*/_jsx(\"td\",{children:p.name}),/*#__PURE__*/_jsx(\"td\",{children:p.quantity})]},p.id))})]})]})]});}function Sales(_ref6){let{t}=_ref6;const[customers,setCustomers]=useState([]);const[productsList,setProductsList]=useState([]);const[selectedCustomerId,setSelectedCustomerId]=useState('');const[customerName,setCustomerName]=useState('');const[previousPending,setPreviousPending]=useState(0);const[items,setItems]=useState([{productName:'',quantity:1,weight:0,pricePerKg:0}]);const[paidNow,setPaidNow]=useState(0);const[calc,setCalc]=useState(null);const[salesRecords,setSalesRecords]=useState([]);const[editingIndex,setEditingIndex]=useState(null);const[editingId,setEditingId]=useState(null);useEffect(()=>{fetch('http://localhost:4000/api/customers').then(r=>r.json()).then(j=>setCustomers(j.customers||[])).catch(()=>{});fetch('http://localhost:4000/api/products').then(r=>r.json()).then(j=>setProductsList(j.products||[])).catch(()=>{});// load existing sales for list + delete\nfetch('http://localhost:4000/api/sales').then(r=>r.json()).then(j=>{if(j.ok)setSalesRecords(j.sales||[]);}).catch(()=>{});},[]);function addCustomer(){const name=prompt('Customer name');if(!name)return;const location=prompt('Location')||'';const prev=Number(prompt('Previous Pending')||0);fetch('http://localhost:4000/api/customers',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,location,previousPending:prev})}).then(r=>r.json()).then(j=>{if(j.ok){setCustomers(prevList=>[...prevList,j.customer]);alert('Customer added');}});}function addItem(){setItems(prev=>[...prev,{productName:'',quantity:1,weight:0,pricePerKg:0}]);}function updateItem(i,key,value){const copy=[...items];copy[i][key]=value;setItems(copy);}function onSelectCustomer(id){setSelectedCustomerId(id);if(!id){setPreviousPending(0);setCustomerName('');return;}const c=customers.find(x=>x.id===Number(id));if(c){setCustomerName(c.name);setPreviousPending(c.previousPending||0);}}async function calculate(){const res=await fetch('http://localhost:4000/api/calculate-invoice',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({products:items,previousPending})});const j=await res.json();setCalc(j);// paidNow + remaining are always derived below, so when you hit Calculate\n// it recomputes customerTotal -> grandTotal -> remaining\n}// ---- totals / derived values ----\nconst customerTotal=calc&&typeof calc.customerTotal!=='undefined'?Number(calc.customerTotal||0):items.reduce((s,it)=>s+Number(it.quantity||0)*Number(it.pricePerKg||0),0);const grandTotal=+(customerTotal+Number(previousPending||0)).toFixed(2);const remaining=+(grandTotal-Number(paidNow||0)).toFixed(2);const logoUrl=localStorage.getItem('erp_logo')||'';function printGate(){const html=\"\\n      <html><body>\\n      <img src='\".concat(logoUrl,\"' style='display:block;margin:0 auto;width:220px;opacity:0.9' />\\n      <h2 style='text-align:center'>Gate Pass</h2>\\n      <div>Customer: \").concat(customerName,\"</div>\\n      <div>Time: \").concat(new Date().toLocaleString(),\"</div>\\n      <table border='1' style='width:100%;border-collapse:collapse'>\\n        <tr>\\n          <th>#</th>\\n          <th>Product</th>\\n          <th>Weight</th>\\n          <th>Qty</th>\\n        </tr>\\n        \").concat(items.map((it,i)=>\"<tr>\\n            <td>\".concat(i+1,\"</td>\\n            <td>\").concat(it.productName,\"</td>\\n            <td>\").concat(it.quantity,\"</td>\\n            <td>\").concat(it.weight,\"</td>\\n          </tr>\")).join(''),\"\\n      </table>\\n      </body></html>\");const w=window.open('','_blank');w.document.write(html);w.document.close();setTimeout(()=>w.print(),300);}function printInvoice(record){const dateTime=record&&record.date?new Date(record.date).toLocaleString():new Date().toLocaleString();const html=\"\\n      <html><body>\\n      <img src='\".concat(logoUrl,\"' style='display:block;margin:0 auto;width:180px;opacity:0.9' />\\n      <h2 style='text-align:center'>Invoice</h2>\\n      <div>Customer: \").concat(customerName,\"</div>\\n      <div>Date &amp; Time: \").concat(dateTime,\"</div>\\n      <table border='1' style='width:100%;border-collapse:collapse'>\\n        <tr>\\n          <th>#</th>\\n          <th>Product</th>\\n          <th>Qty</th>\\n          <th>Weight</th>\\n          <th>Price</th>\\n          <th>Line Total</th>\\n        </tr>\\n        \").concat(items.map((it,i)=>\"\\n          <tr>\\n            <td>\".concat(i+1,\"</td>\\n            <td>\").concat(it.productName,\"</td>\\n            <td>\").concat(it.quantity,\"</td>\\n            <td>\").concat(it.weight,\"</td>\\n            <td>\").concat(it.pricePerKg,\"</td>\\n            <td>\").concat((Number(it.quantity||0)*Number(it.weight||0)*Number(it.pricePerKg||0)).toFixed(2),\"</td>\\n          </tr>\")).join(''),\"\\n      </table>\\n      <h3>Customer Total: \").concat(customerTotal.toFixed(2),\"</h3>\\n      <div>Previous Pending: \").concat(Number(previousPending||0).toFixed(2),\"</div>\\n      <div>Grand Total: \").concat(grandTotal.toFixed(2),\"</div>\\n      <div>Paid: \").concat(Number(paidNow||0).toFixed(2),\"</div>\\n      <div>Remaining: \").concat(remaining.toFixed(2),\"</div>\\n      </body></html>\\n    \");const w=window.open('','_blank');w.document.write(html);w.document.close();setTimeout(()=>w.print(),300);}async function saveAndPrint(){const res=await fetch('http://localhost:4000/api/save-sale',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({customerId:selectedCustomerId,customerName,previousPending,products:items,paidNow})});const j=await res.json();if(j.ok){alert('Saved. Remaining added to customer previous pending: '+j.record.pending);setSalesRecords(prev=>[...prev,j.record]);fetch('http://localhost:4000/api/customers').then(r=>r.json()).then(j2=>setCustomers(j2.customers||[])).catch(()=>{});printInvoice(j.record);// only invoice window, not whole page\n}}async function deleteSale(id){if(!window.confirm('Delete this sale?'))return;const res=await fetch(\"http://localhost:4000/api/sales/\".concat(id),{method:'DELETE'});const j=await res.json();if(j.ok){setSalesRecords(prev=>prev.filter(s=>s.id!==id));}else{alert('Failed to delete sale');}}/* Sales Edit Function *//* Sales Edit Function *//* Sales Edit Function */function editSales(index){const s=salesRecords[index];if(!s)return;// Customer info\nsetSelectedCustomerId(s.customerId||\"\");setCustomerName(s.customerName||\"\");setPreviousPending(Number(s.previousPending||0));setPaidNow(Number(s.paidNow||0));// Items restore\nconst restoredItems=(s.products||s.lines||[]).map(item=>{var _ref7,_item$quantity,_item$weight,_ref8,_item$pricePerKg;return{productName:item.productName||\"\",quantity:Number((_ref7=(_item$quantity=item.quantity)!==null&&_item$quantity!==void 0?_item$quantity:item.qty)!==null&&_ref7!==void 0?_ref7:0),weight:Number((_item$weight=item.weight)!==null&&_item$weight!==void 0?_item$weight:0),pricePerKg:Number((_ref8=(_item$pricePerKg=item.pricePerKg)!==null&&_item$pricePerKg!==void 0?_item$pricePerKg:item.price)!==null&&_ref8!==void 0?_ref8:0)};});setItems(restoredItems.length?restoredItems:[{productName:\"\",quantity:1,weight:0,pricePerKg:0}]);setEditingIndex(index);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:\"Sales / Invoice\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/80 p-4 rounded shadow mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-2\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"border p-2 rounded\",value:selectedCustomerId,onChange:e=>onSelectCustomer(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Customer\"}),customers.map(c=>/*#__PURE__*/_jsxs(\"option\",{value:c.id,children:[c.name,\" - \",c.location]},c.id))]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Customer Name\",value:customerName,onChange:e=>setCustomerName(e.target.value),className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Previous Pending\",value:previousPending,onChange:e=>setPreviousPending(Number(e.target.value)),className:\"border p-2 rounded\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-3\",children:/*#__PURE__*/_jsx(\"button\",{onClick:addCustomer,className:\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm\",children:t('addCustomer')})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/80 p-4 rounded shadow mb-4\",children:[/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-sm\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-sky-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Weight\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Line Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:items.map((it,i)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:i+1}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 rounded w-full\",value:it.productName,onChange:e=>updateItem(i,'productName',e.target.value),list:\"products-list\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 rounded w-20 text-right\",type:\"number\",value:it.quantity,onChange:e=>updateItem(i,'quantity',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 rounded w-24 text-right\",type:\"number\",value:it.weight,onChange:e=>updateItem(i,'weight',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 rounded w-24 text-right\",type:\"number\",value:it.pricePerKg,onChange:e=>updateItem(i,'pricePerKg',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:(Number(it.quantity||0)*Number(it.weight||0)*Number(it.pricePerKg||0)).toFixed(2)})]},i))})]}),/*#__PURE__*/_jsx(\"datalist\",{id:\"products-list\",children:productsList.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.name},p.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-3 mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:addItem,className:\"px-3 py-1 bg-white border rounded hover:shadow transition text-sm\",children:\"\\u2795 Add Item\"}),/*#__PURE__*/_jsx(\"button\",{onClick:calculate,className:\"px-3 py-1 bg-sky-600 text-white rounded hover:bg-sky-700 transition text-sm\",children:\"Calculate\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-auto flex flex-wrap items-center gap-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm\",children:\"Paid Now\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:paidNow,onChange:e=>setPaidNow(Number(e.target.value)),className:\"border p-1 rounded w-28 text-right\"}),/*#__PURE__*/_jsx(\"button\",{onClick:saveAndPrint,className:\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition text-sm\",children:t('savePrint')})]}),/*#__PURE__*/_jsx(\"button\",{onClick:printGate,className:\"px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-800 transition text-sm\",children:\"Gate Pass\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 p-3 bg-gray-50 rounded text-sm space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Customer Total:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:customerTotal.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Previous Pending:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:Number(previousPending||0).toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Grand Total:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:grandTotal.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Paid Now:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:Number(paidNow||0).toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Remaining:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:remaining.toFixed(2)})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white/80 p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2 text-sm\",children:\"Saved Invoices\"}),salesRecords.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No invoices saved yet.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Customer\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Date/Time\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Grand Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Remaining\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:salesRecords.map((s,idx)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:idx+1}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:s.customerName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:s.date}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:s.grandTotal}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:s.paidNow}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:s.pending}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 text-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>editSales(idx),className:\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\",children:\"Action\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteSale(s.id),className:\"px-2 py-1 text-xs bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1\"})]})]},s.id))})]})]})]});}/* ================= Vendor Purchase Management (standalone) ================= */function VendorPurchaseManagement(_ref9){let{t}=_ref9;const[vendorsSummary,setVendorsSummary]=useState([]);// [{vendorName, totalPending, totalGrand, totalPaid, purchases: []}]\nconst[selectedVendorName,setSelectedVendorName]=useState(\"\");const[loading,setLoading]=useState(false);const[err,setErr]=useState(\"\");// Load all pending purchases from backend\nuseEffect(()=>{loadVendorPurchases();},[]);async function loadVendorPurchases(){try{setLoading(true);setErr(\"\");const res=await fetch(\"http://localhost:4000/api/purchases-with-pending\");const j=await res.json();if(!j.ok){throw new Error(j.message||\"Failed to load vendor purchases\");}const list=j.purchases||[];// Group by vendorName\nconst map=new Map();list.forEach(p=>{const name=p.vendorName||\"Unknown\";if(!map.has(name)){map.set(name,{vendorName:name,totalPending:0,totalGrand:0,totalPaid:0,purchases:[]});}const g=map.get(name);g.totalPending+=Number(p.pending||0);g.totalGrand+=Number(p.grandTotal||0);g.totalPaid+=Number(p.paidNow||0);g.purchases.push(p);});const groups=Array.from(map.values()).sort((a,b)=>b.totalPending-a.totalPending);setVendorsSummary(groups);// auto-select first vendor if none selected\nif(!selectedVendorName&&groups.length>0){setSelectedVendorName(groups[0].vendorName);}}catch(e){console.error(e);setErr(e.message||\"Failed to load vendor purchases\");}finally{setLoading(false);}}async function handleDeletePurchase(purchase){if(!purchase)return;if(!window.confirm(\"Delete this purchase record?\"))return;try{const res=await fetch(\"http://localhost:4000/api/purchases/\".concat(purchase.id),{method:\"DELETE\"});const j=await res.json();if(!j.ok){alert(j.message||\"Purchase not found!\");return;}// Reload summary from backend so stale records disappear\nawait loadVendorPurchases();}catch(e){console.error(e);alert(\"Error deleting purchase\");}}const selectedVendorSummary=vendorsSummary.find(v=>v.vendorName===selectedVendorName)||null;const totalPendingAll=vendorsSummary.reduce((sum,v)=>sum+v.totalPending,0);return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-2\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-sm flex-1\",children:\"Vendor Purchase Management\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadVendorPurchases,className:\"px-2 py-1 text-xs border rounded\",children:\"Refresh\"})]}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mb-2\",children:\"Loading vendor purchases\\u2026\"}),err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-red-600 mb-2\",children:err}),vendorsSummary.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No purchases yet. Once you save purchases, you will see vendor-wise summary here.\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-1 border rounded p-3\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2 text-xs\",children:\"Vendors (total purchase & pending)\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-[11px]\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-1 text-left\",children:\"Vendor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-1 text-right\",children:\"Pending\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:vendorsSummary.map(v=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t cursor-pointer \"+(v.vendorName===selectedVendorName?\"bg-sky-50\":\"\"),onClick:()=>setSelectedVendorName(v.vendorName),children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-1\",children:v.vendorName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-1 text-right\",children:v.totalPending.toFixed(2)})]},v.vendorName))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-xs text-gray-600\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Pending: \"}),totalPendingAll.toFixed(2)]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-2 border rounded p-3\",children:!selectedVendorSummary?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Select a vendor on the left to see full record of your purchases, paid amounts, and remaining balance for that vendor.\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between mb-3 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:selectedVendorSummary.vendorName}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-gray-500\",children:[\"Total Pending:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedVendorSummary.totalPending.toFixed(2)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Total Grand:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedVendorSummary.totalGrand.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Total Paid:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:selectedVendorSummary.totalPaid.toFixed(2)})]})]})]}),selectedVendorSummary.purchases.map(p=>{const items=p.products||[];return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded mb-3 p-2 text-[11px]\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between mb-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Date: \"}),p.date?new Date(p.date).toLocaleString():\"-\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Grand: \"}),p.grandTotal,\" \\xA0|\\xA0\",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Paid: \"}),p.paidNow,\" \\xA0|\\xA0\",/*#__PURE__*/_jsxs(\"span\",{className:\"font-semibold\",children:[\"Remaining:\",\" \"]}),p.pending]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-[11px] border mt-1\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Weight\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Line Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:items.map((it,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:idx+1}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:it.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:it.qty||it.quantity}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:it.weight}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:it.pricePerKg||it.price}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:it.lineTotal})]},idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex justify-end gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>alert(\"Edit in form: we can wire this to Purchases later.\"),className:\"px-2 py-1 bg-sky-600 text-white rounded\",children:\"Edit in Form\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeletePurchase(p),className:\"px-2 py-1 bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1 Delete\"})]})]},p.id);})]})})]})]});}/* Purchases */function Purchases(_ref0){let{t}=_ref0;const[vendorName,setVendorName]=useState('');const[rows,setRows]=useState([{productName:'',qty:1,weight:0,pricePerKg:0}]);const[paidNow,setPaidNow]=useState(0);const[mode,setMode]=useState('cash');const[records,setRecords]=useState([]);const[editingIndex,setEditingIndex]=useState(null);const[editingId,setEditingId]=useState(null);const[filterDate,setFilterDate]=useState('');// <-- NEW: date filter\nconst[selectedVendorName,setSelectedVendorName]=useState('');// Build a map: vendorName -> aggregated info + list of their purchases\nconst vendorMap=new Map();(records||[]).forEach(r=>{const name=r.vendorName||'Unknown';if(!vendorMap.has(name)){vendorMap.set(name,{vendorName:name,totalGrand:0,totalPaid:0,totalPending:0,purchases:[]});}const entry=vendorMap.get(name);entry.totalGrand+=Number(r.grandTotal||0);entry.totalPaid+=Number(r.paidNow||0);entry.totalPending+=Number(r.pending||0);entry.purchases.push(r);});// Sorted list of vendors (by pending desc)\nconst vendorsSummary=Array.from(vendorMap.values()).sort((a,b)=>b.totalPending-a.totalPending);const selectedVendorSummary=vendorsSummary.find(v=>v.vendorName===selectedVendorName)||null;// ===== Persistent storage of purchases in localStorage =====\n// 🔹 1) Load from localStorage on mount\nuseEffect(()=>{try{const raw=localStorage.getItem('erp_purchases');if(!raw)return;const parsed=JSON.parse(raw);if(Array.isArray(parsed)){setRecords(parsed);}}catch(e){console.error('Failed to load purchases from localStorage',e);}},[]);// 🔹 2) Save to localStorage whenever records change\nuseEffect(()=>{try{localStorage.setItem('erp_purchases',JSON.stringify(records));}catch(e){console.error('Failed to save purchases to localStorage',e);}},[records]);function addRow(){setRows(prev=>[...prev,{productName:'',qty:1,weight:0,pricePerKg:0}]);}function updateRow(i,key,value){const a=[...rows];a[i][key]=value;setRows(a);}const total=rows.reduce((s,r)=>s+Number(r.qty||0)*Number(r.weight||0)*Number(r.pricePerKg||0),0);const remaining=+(total-Number(paidNow||0)).toFixed(2);async function savePurchase(){// normalize payload from form\nconst payloadProducts=rows.map(r=>({productName:r.productName,qty:Number(r.qty||0),weight:Number(r.weight||0),pricePerKg:Number(r.pricePerKg||0)}));const payload={vendorName,products:payloadProducts,paidNow,modeOfPayment:mode};try{let j;if(editingIndex!==null&&editingId){// UPDATE existing purchase\nconst res=await fetch(\"http://localhost:4000/api/purchases/\".concat(editingId),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});j=await res.json();if(!j.ok){alert(j.message||'Failed to update purchase');return;}const updated=j.record;setRecords(prev=>prev.map(p=>p.id===updated.id?updated:p));alert('Purchase updated');}else{// CREATE new purchase\nconst res=await fetch('http://localhost:4000/api/save-purchase',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});j=await res.json();if(!j.ok){alert(j.message||'Failed to save purchase');return;}setRecords(prev=>[...prev,j.record]);alert('Purchase saved');}// reset editing + form\nsetEditingIndex(null);setEditingId(null);setVendorName('');setPaidNow(0);setMode('cash');setRows([{productName:'',qty:1,weight:0,pricePerKg:0}]);}catch(e){console.error(e);alert('Error saving purchase');}}function editPurchase(index){const r=records[index];if(!r)return;// Fill form with this purchase\nsetVendorName(r.vendorName||'');setPaidNow(Number(r.paidNow||0));setMode(r.modeOfPayment||'cash');const restoredRows=(r.products||[]).map(p=>({productName:p.productName,qty:p.qty||p.quantity||0,weight:p.weight||0,pricePerKg:p.pricePerKg||p.price||0}));setRows(restoredRows.length?restoredRows:[{productName:'',qty:1,weight:0,pricePerKg:0}]);// 🔹 these two lines are the important part:\nsetEditingIndex(index);setEditingId(r.id);}async function deletePurchase(index){const r=records[index];if(!r||!r.id)return;if(!window.confirm('Delete this purchase?'))return;try{const res=await fetch(\"http://localhost:4000/api/purchases/\".concat(r.id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete purchase');return;}setRecords(prev=>prev.filter(x=>x.id!==r.id));alert('Purchase deleted');}catch(e){console.error(e);alert('Error deleting purchase');}}// --- Filtered records by date (yyyy-mm-dd) ---\nconst displayedRecords=filterDate?records.filter(r=>{if(!r.date)return false;// r.date usually ISO string: \"2025-11-15T10:30:00.000Z\"\nreturn r.date.slice(0,10)===filterDate;}):records;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:t('purchases')}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:t('vendorName'),value:vendorName,onChange:e=>setVendorName(e.target.value),className:\"border p-2 w-full mb-3\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-sky-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Weight\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:rows.map((r,i)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:i+1}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1\",value:r.productName,onChange:e=>updateRow(i,'productName',e.target.value)})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 w-20\",type:\"number\",value:r.qty,onChange:e=>updateRow(i,'qty',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 w-24\",type:\"number\",value:r.weight,onChange:e=>updateRow(i,'weight',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsx(\"input\",{className:\"border p-1 w-28\",type:\"number\",value:r.pricePerKg,onChange:e=>updateRow(i,'pricePerKg',Number(e.target.value))})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:(Number(r.qty||0)*Number(r.weight||0)*Number(r.pricePerKg||0)).toFixed(2)})]},i))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:addRow,className:\"px-3 py-1 border rounded hover:shadow transition\",children:\"\\u2795 Add Item\"}),/*#__PURE__*/_jsxs(\"select\",{value:mode,onChange:e=>setMode(e.target.value),className:\"border p-1 rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:t('cash')}),/*#__PURE__*/_jsx(\"option\",{value:\"card\",children:t('card')}),/*#__PURE__*/_jsx(\"option\",{value:\"cheque\",children:t('cheque')}),/*#__PURE__*/_jsx(\"option\",{value:\"online\",children:t('online')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-auto flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Amount Paid\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:paidNow,onChange:e=>setPaidNow(Number(e.target.value)),className:\"border p-1 w-28\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-3 py-2 bg-gray-50 rounded\",children:[\"Remaining:\",' ',/*#__PURE__*/_jsx(\"strong\",{children:remaining.toFixed(2)})]}),/*#__PURE__*/_jsx(\"button\",{onClick:savePurchase,className:\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition\",children:editingIndex!==null?'Update Purchase':'Save Purchase'})]})]})]}),/*#__PURE__*/_jsx(VendorPurchaseManagement,{t:t})]});}async function loadPurchases(){try{const res=await fetch('http://localhost:4000/api/purchases');const j=await res.json();if(!j.ok){console.error(j.message||'Failed to load purchases');return;}setRecords(j.purchases||[]);}catch(e){console.error('Error loading purchases',e);}}/* Reports / Debits placeholders */function Reports(_ref1){let{t}=_ref1;const[date,setDate]=useState(()=>new Date().toISOString().slice(0,10));const[report,setReport]=useState(null);const[loading,setLoading]=useState(false);const[err,setErr]=useState('');async function loadReport(e){if(e&&e.preventDefault)e.preventDefault();if(!date){alert('Select a date');return;}setLoading(true);setErr('');setReport(null);try{const res=await fetch(\"http://localhost:4000/api/reports/day?date=\".concat(date));const j=await res.json();if(!j.ok)throw new Error(j.message||'Failed to load report');setReport(j);}catch(e){console.error(e);setErr('Failed to load report');}finally{setLoading(false);}}// Optional: auto-load for today on first open\n// useEffect(() => { loadReport(); }, []);\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:\"Reports\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white p-4 rounded shadow mb-4\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:loadReport,className:\"flex flex-wrap items-end gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium mb-1\",children:\"Select Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:date,onChange:e=>setDate(e.target.value),className:\"border p-2 rounded\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"px-4 py-2 bg-sky-600 text-white rounded hover:bg-sky-700 transition\",children:loading?'Loading…':'Load Report'}),err&&/*#__PURE__*/_jsx(\"span\",{className:\"text-red-600 text-sm ml-2\",children:err})]})}),!report&&!loading&&!err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Select a date and click \\\"Load Report\\\" to view details.\"}),report&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Total Sales\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:Number(report.totalSales||0).toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Amount Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:Number(report.totalReceived||0).toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"Number of Bills\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:(report.invoices||[]).length})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"font-semibold mb-2\",children:[\"Products Sold on \",report.date]}),(report.productsSummary||[]).length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"No products sold on this date.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-sm border\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-2 py-1 text-left\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-2 py-1 text-right\",children:\"Total Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-2 py-1 text-right\",children:\"Total Weight\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:report.productsSummary.map((p,i)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-2 py-1\",children:p.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-2 py-1 text-right\",children:p.totalQty}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-2 py-1 text-right\",children:p.totalWeight})]},i))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-2\",children:\"Bills / Invoices\"}),(report.invoices||[]).length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"No invoices on this date.\"}),(report.invoices||[]).map(inv=>/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded mb-4 p-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between text-sm mb-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Customer: \"}),inv.customerName]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Time: \"}),inv.date]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 text-sm mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Grand Total: \",inv.grandTotal]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Paid: \",inv.paidNow]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Pending:  \",inv.pending]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs border\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Weight\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"border px-1 py-0.5\",children:\"Line Total\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:(inv.products||inv.lines||[]).map((p,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:idx+1}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.productName}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.quantity||p.qty}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.weight}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.pricePerKg||p.price}),/*#__PURE__*/_jsx(\"td\",{className:\"border px-1 py-0.5\",children:p.lineTotal})]},idx))})]})]},inv.id))]})]})]});}/*Debits*/function Debits(_ref10){var _vendors$find$remaini,_vendors$find;let{t}=_ref10;const[vendors,setVendors]=useState([]);const[selectedVendorId,setSelectedVendorId]=useState('');// Add / edit vendor form\nconst[vendorName,setVendorName]=useState('');const[vendorPlace,setVendorPlace]=useState('');const[vendorCompany,setVendorCompany]=useState('');const[editingVendorId,setEditingVendorId]=useState(null);// Ledger & transaction form\nconst[ledger,setLedger]=useState([]);const[txType,setTxType]=useState('received');// 'received' | 'paid' | 'goods'\nconst[txAmount,setTxAmount]=useState(0);const[txMethod,setTxMethod]=useState('');const[txBillRef,setTxBillRef]=useState('');const[txDate,setTxDate]=useState('');const[editingTxId,setEditingTxId]=useState(null);// Purchases with pending (Purchased Vendor section)\nconst[purchaseDebits,setPurchaseDebits]=useState([]);const[loadingPurchases,setLoadingPurchases]=useState(false);useEffect(()=>{loadVendors();loadPurchaseDebits();},[]);async function loadVendors(){try{const res=await fetch('http://localhost:4000/api/vendors');const j=await res.json();if(j.ok)setVendors(j.vendors||[]);}catch(e){console.error('Failed to load vendors',e);}}async function loadLedger(vendorId){if(!vendorId){setLedger([]);return;}try{const res=await fetch(\"http://localhost:4000/api/vendors/\".concat(vendorId,\"/ledger\"));const j=await res.json();if(j.ok){setLedger(j.ledger||[]);// update vendors list with new remaining\nsetVendors(prev=>prev.map(v=>v.id===vendorId?j.vendor:v));}}catch(e){console.error('Failed to load ledger',e);}}async function loadPurchaseDebits(){try{setLoadingPurchases(true);const res=await fetch('http://localhost:4000/api/purchases-with-pending');const j=await res.json();if(j.ok)setPurchaseDebits(j.purchases||[]);}catch(e){console.error('Failed to load purchase debits',e);}finally{setLoadingPurchases(false);}}function onSelectVendor(id){setSelectedVendorId(id);setEditingTxId(null);resetTxForm();if(id)loadLedger(id);else setLedger([]);}// --- Vendor form helpers ---\nfunction startNewVendor(){setVendorName('');setVendorPlace('');setVendorCompany('');setEditingVendorId(null);}function startEditVendor(vendor){setVendorName(vendor.name||'');setVendorPlace(vendor.place||'');setVendorCompany(vendor.company||'');setEditingVendorId(vendor.id);}async function saveVendor(){if(!vendorName){alert('Vendor name is required');return;}const payload={id:editingVendorId||undefined,name:vendorName,place:vendorPlace,company:vendorCompany};try{const res=await fetch('http://localhost:4000/api/vendors',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const j=await res.json();if(!j.ok){alert(j.message||'Failed to save vendor');return;}const v=j.vendor;setVendors(prev=>{const idx=prev.findIndex(x=>x.id===v.id);if(idx===-1)return[...prev,v];const copy=[...prev];copy[idx]=v;return copy;});setVendorName('');setVendorPlace('');setVendorCompany('');setEditingVendorId(null);}catch(e){console.error(e);alert('Error saving vendor');}}async function deleteVendor(vendor){if(!window.confirm(\"Delete vendor \\\"\".concat(vendor.name,\"\\\" and all its debits?\")))return;try{const res=await fetch(\"http://localhost:4000/api/vendors/\".concat(vendor.id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete vendor');return;}setVendors(prev=>prev.filter(v=>v.id!==vendor.id));if(selectedVendorId===vendor.id){setSelectedVendorId('');setLedger([]);}}catch(e){console.error(e);alert('Error deleting vendor');}}async function deletePurchaseDebit(p){if(!p||!p.id)return;if(!window.confirm('Delete this pending purchase?'))return;try{const res=await fetch(\"http://localhost:4000/api/purchases/\".concat(p.id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete purchase');return;}// remove from local pending list\nsetPurchaseDebits(prev=>prev.filter(x=>x.id!==p.id));alert('Purchase deleted');}catch(e){console.error(e);alert('Error deleting purchase');}}// --- Transaction form helpers ---\nfunction resetTxForm(){setTxType('received');setTxAmount(0);setTxMethod('');setTxBillRef('');setTxDate('');setEditingTxId(null);}function startEditTx(tx){setTxType(tx.type);setTxAmount(tx.amount);setTxMethod(tx.method||'');setTxBillRef(tx.billRef||'');setTxDate(tx.date?tx.date.slice(0,10):'');setEditingTxId(tx.id);}async function saveTransaction(){if(!selectedVendorId){alert('Select a vendor first');return;}if(!txAmount||Number(txAmount)<=0){alert('Amount must be greater than 0');return;}const payload={type:txType,// 'received' | 'paid' | 'goods'\namount:Number(txAmount),method:txMethod,billRef:txBillRef,date:txDate?new Date(txDate).toISOString():undefined};try{let url=\"http://localhost:4000/api/vendors/\".concat(selectedVendorId,\"/transactions\");let method='POST';if(editingTxId){url+=\"/\".concat(editingTxId);method='PUT';}const res=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const j=await res.json();if(!j.ok){alert(j.message||'Failed to save transaction');return;}setLedger(j.ledger||[]);setVendors(prev=>prev.map(v=>v.id===selectedVendorId?j.vendor:v));resetTxForm();}catch(e){console.error(e);alert('Error saving transaction');}}async function deleteTransaction(tx){if(!selectedVendorId)return;if(!window.confirm('Delete this transaction?'))return;try{const res=await fetch(\"http://localhost:4000/api/vendors/\".concat(selectedVendorId,\"/transactions/\").concat(tx.id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete');return;}setLedger(j.ledger||[]);setVendors(prev=>prev.map(v=>v.id===selectedVendorId?j.vendor:v));}catch(e){console.error(e);alert('Error deleting transaction');}}// --- Edit/Delete purchase debits (Pending purchases) ---\nasync function editPurchaseDebit(p){if(!p||!p.id)return;// Ask how much is paid now (or you can design a better UI later)\nconst newPaidStr=prompt('Enter new paid amount for this purchase:',String(p.paidNow||0));if(newPaidStr===null)return;// cancelled\nconst newPaid=Number(newPaidStr);if(isNaN(newPaid)){alert('Invalid amount');return;}const payload={vendorName:p.vendorName,products:p.products||[],paidNow:newPaid,modeOfPayment:p.modeOfPayment};try{const res=await fetch(\"http://localhost:4000/api/purchases/\".concat(p.id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const j=await res.json();if(!j.ok){alert(j.message||'Failed to update purchase');return;}const updated=j.record;// Update local pending list\nsetPurchaseDebits(prev=>{const arr=prev.map(x=>x.id===updated.id?updated:x)// if pending <= 0, remove from \"pending\" list\n.filter(x=>Number(x.pending||0)>0);return arr;});alert('Purchase updated');}catch(e){console.error(e);alert('Error updating purchase');}}async function deletePurchase(index){const rec=records[index];if(!rec)return;if(!window.confirm('Delete this purchase?'))return;try{// tell backend to delete it\nconst res=await fetch(\"http://localhost:4000/api/purchases/\".concat(rec.id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete purchase');return;}// remove from local list\nsetRecords(prev=>prev.filter(r=>r.id!==rec.id));// if you’re editing this one, reset edit state\nsetEditingIndex(null);alert('Purchase deleted');}catch(e){console.error(e);alert('Error deleting purchase');}}// --- Ledger summary ---\nconst totalReceived=ledger.filter(tx=>tx.type==='received').reduce((s,tx)=>s+Number(tx.amount||0),0);const totalPaid=ledger.filter(tx=>tx.type==='paid').reduce((s,tx)=>s+Number(tx.amount||0),0);const totalGoods=ledger.filter(tx=>tx.type==='goods').reduce((s,tx)=>s+Number(tx.amount||0),0);const remaining=(_vendors$find$remaini=(_vendors$find=vendors.find(v=>v.id===selectedVendorId))===null||_vendors$find===void 0?void 0:_vendors$find.remaining)!==null&&_vendors$find$remaini!==void 0?_vendors$find$remaini:0;const selectedVendor=vendors.find(v=>v.id===selectedVendorId)||null;// Purchases filtered by selected vendor (if any)\nconst filteredPurchases=selectedVendor?purchaseDebits.filter(p=>(p.vendorName||'').toLowerCase()===(selectedVendor.name||'').toLowerCase()):purchaseDebits;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:\"Debits\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-1 space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Vendor Debit Management\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"border p-2 rounded w-full\",placeholder:\"Vendor Name\",value:vendorName,onChange:e=>setVendorName(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"border p-2 rounded w-full\",placeholder:\"Place / Location\",value:vendorPlace,onChange:e=>setVendorPlace(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"border p-2 rounded w-full\",placeholder:\"Company Name\",value:vendorCompany,onChange:e=>setVendorCompany(e.target.value)}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:saveVendor,className:\"px-3 py-1 bg-teal-600 text-white rounded hover:bg-teal-700 text-sm\",children:editingVendorId?'Update Vendor':'Save Vendor'}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewVendor,className:\"px-3 py-1 border rounded text-sm\",children:\"New\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow max-h-[400px] overflow-auto\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:\"Vendors\"}),vendors.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"No vendors yet.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Remaining\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-center\",children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:vendors.map(v=>/*#__PURE__*/_jsxs(\"tr\",{className:'border-t '+(v.id===selectedVendorId?'bg-sky-50':''),children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onSelectVendor(v.id),className:\"text-left text-xs hover:underline\",children:[v.name,v.company?\" (\".concat(v.company,\")\"):'']})}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(v.remaining||0).toFixed(2)}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 text-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>startEditVendor(v),className:\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteVendor(v),className:\"px-2 py-1 text-xs bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1\"})]})]},v.id))})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-2 space-y-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold mb-3\",children:selectedVendorId?'Vendor Ledger':'Select a Vendor'}),selectedVendorId&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-sky-50 p-2 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Total Received\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:totalReceived.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-sky-50 p-2 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Total Paid\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:totalPaid.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-sky-50 p-2 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Goods Purchased\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:totalGoods.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-sky-50 p-2 rounded\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Remaining\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:Number(remaining||0).toFixed(2)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-3 mb-4 text-sm\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2\",children:editingTxId?'Edit Transaction':'Add Transaction'}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-5 gap-2\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"border p-2 rounded\",value:txType,onChange:e=>setTxType(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"received\",children:\"Received from Vendor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"paid\",children:\"Paid to Vendor\"}),/*#__PURE__*/_jsx(\"option\",{value:\"goods\",children:\"Goods Purchased (vendor takes goods)\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"border p-2 rounded\",placeholder:\"Amount\",value:txAmount,onChange:e=>setTxAmount(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"border p-2 rounded\",value:txDate,onChange:e=>setTxDate(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"border p-2 rounded\",placeholder:\"Payment Method\",value:txMethod,onChange:e=>setTxMethod(e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"border p-2 rounded\",placeholder:\"Remarks\",value:txBillRef,onChange:e=>setTxBillRef(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:saveTransaction,className:\"px-3 py-1 bg-teal-600 text-white rounded text-sm\",children:editingTxId?'Update Transaction':'Save Transaction'}),/*#__PURE__*/_jsx(\"button\",{onClick:resetTxForm,className:\"px-3 py-1 border rounded text-sm\",children:\"Clear\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-[380px] overflow-auto text-xs\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Type\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Method\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Remarks\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Balance After\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[ledger.map(tx=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:tx.date?new Date(tx.date).toLocaleDateString():'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 capitalize\",children:tx.type}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(tx.amount||0).toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:tx.method}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:tx.billRef}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(tx.balanceAfter||0).toFixed(2)}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 text-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>startEditTx(tx),className:\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteTransaction(tx),className:\"px-2 py-1 text-xs bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1\"})]})]},tx.id)),ledger.length===0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:7,className:\"p-2 text-center text-gray-500\",children:\"No transactions yet.\"})})]})]})})]}),!selectedVendorId&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Select a vendor on the left to view and manage their debits.\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mb-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold\",children:\"Purchased Vendor (Pending Purchases)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadPurchaseDebits,className:\"ml-auto px-3 py-1 text-xs border rounded\",children:loadingPurchases?'Refreshing…':'Refresh'})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mb-2\",children:[\"Showing all purchases where some amount is still pending.\",selectedVendor?\" (Filtered by vendor: \".concat(selectedVendor.name,\")\"):' (All vendors)']}),/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-100\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Vendor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Product\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Qty\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Grand Total\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Paid\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-right\",children:\"Remaining\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Mode\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[filteredPurchases.map(p=>{const productsList=(p.products||[]).map(x=>x.productName).join(', ');const totalQty=(p.products||[]).reduce((s,x)=>s+Number(x.qty||x.quantity||0),0);return/*#__PURE__*/_jsxs(\"tr\",{className:\"border-t\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:p.vendorName}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:p.date?new Date(p.date).toLocaleDateString():'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:productsList||'-'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:totalQty}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(p.grandTotal||0).toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(p.paidNow||0).toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-right\",children:Number(p.pending||0).toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:p.modeOfPayment}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 text-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>editPurchaseDebit(p),className:\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\",children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deletePurchaseDebit(p),className:\"px-2 py-1 text-xs bg-red-600 text-white rounded\",children:\"\\uD83D\\uDDD1\"})]})]},p.id);}),filteredPurchases.length===0&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{className:\"p-2 text-center text-gray-500\",colSpan:9,children:\"No pending purchases found.\"})})]})]})]})]});}function RecycleBin(_ref11){let{t}=_ref11;const[activeType,setActiveType]=useState('sales');// 'sales' | 'purchases' | 'vendors' | 'customers'\nconst[items,setItems]=useState([]);const[loading,setLoading]=useState(false);const[err,setErr]=useState('');async function loadItems(){let type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:activeType;try{setLoading(true);setErr('');const res=await fetch(\"http://localhost:4000/api/recycle-bin/\".concat(type));const j=await res.json();if(!j.ok)throw new Error(j.message||'Failed to load recycle bin');setItems(j.items||[]);}catch(e){console.error(e);setErr(e.message||'Failed to load recycle bin');}finally{setLoading(false);}}useEffect(()=>{loadItems('sales');},[]);function changeType(type){setActiveType(type);loadItems(type);}async function handleRestore(id){if(!window.confirm('Restore this record?'))return;try{const res=await fetch('http://localhost:4000/api/recycle-bin/restore',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:activeType,id})});const j=await res.json();if(!j.ok){alert(j.message||'Failed to restore');return;}await loadItems();alert('Restored successfully');}catch(e){console.error(e);alert('Error restoring item');}}async function handleDelete(id){if(!window.confirm('Permanently delete this item?'))return;try{const res=await fetch(\"http://localhost:4000/api/recycle-bin/\".concat(activeType,\"/\").concat(id),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete from recycle bin');return;}await loadItems();}catch(e){console.error(e);alert('Error deleting item');}}async function handleDeleteAll(){if(!window.confirm(\"Permanently delete ALL \".concat(activeType,\" items from recycle bin?\")))return;try{const res=await fetch(\"http://localhost:4000/api/recycle-bin/\".concat(activeType),{method:'DELETE'});const j=await res.json();if(!j.ok){alert(j.message||'Failed to delete all');return;}await loadItems();}catch(e){console.error(e);alert('Error deleting all items');}}// small helper to show a label per item\nfunction renderMainLabel(item){if(activeType==='sales'){return\"\".concat(item.customerName||'Unknown',\" \\u2014 Grand: \").concat(item.grandTotal,\" | Pending: \").concat(item.pending);}if(activeType==='purchases'){return\"\".concat(item.vendorName||'Unknown',\" \\u2014 Grand: \").concat(item.grandTotal,\" | Pending: \").concat(item.pending);}if(activeType==='vendors'){return\"\".concat(item.name||'Vendor',\" \\u2014 Remaining: \").concat(item.remaining||0);}if(activeType==='customers'){return\"\".concat(item.name||'Customer',\" \\u2014 Pending: \").concat(item.previousPending||0);}return'Item';}function formatDate(iso){if(!iso)return'';try{return new Date(iso).toLocaleString();}catch(_unused){return iso;}}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:\"Recycle Bin\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mb-4\",children:[['sales','purchases','vendors','customers'].map(type=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>changeType(type),className:'px-3 py-1 rounded text-sm '+(activeType===type?'bg-sky-600 text-white':'bg-white text-sky-700 border'),children:type.charAt(0).toUpperCase()+type.slice(1)},type)),/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadItems(),className:\"ml-auto px-3 py-1 text-xs bg-gray-100 border rounded hover:bg-gray-200\",children:\"Refresh\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDeleteAll,className:\"px-3 py-1 text-xs bg-red-100 text-red-700 border border-red-300 rounded hover:bg-red-200\",children:\"Delete All Permanently\"})]}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 mb-2\",children:\"Loading recycle bin\\u2026\"}),err&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-600 mb-2\",children:err}),items.length===0?/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"No deleted \",activeType,\" records in recycle bin.\"]}):/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded shadow divide-y\",children:items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 flex flex-wrap justify-between items-center text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-0.5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:renderMainLabel(item)}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"ID: \",item.id,' ',item.date&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"| Date: \",formatDate(item.date)]}),item.deletedAt&&/*#__PURE__*/_jsxs(_Fragment,{children:[' ',\"| Deleted:\",' ',formatDate(item.deletedAt)]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2 mt-1 sm:mt-0\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRestore(item.id),className:\"px-2 py-1 text-xs bg-emerald-600 text-white rounded\",children:\"Restore\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(item.id),className:\"px-2 py-1 text-xs bg-red-600 text-white rounded\",children:\"Delete\"})]})]},item.id))})]});}/* Settings */function Settings(_ref12){let{t,onLogoChange}=_ref12;const[logoData,setLogoData]=useState(localStorage.getItem('erp_logo')||'');function upload(e){const f=e.target.files[0];if(!f)return;const reader=new FileReader();reader.onload=ev=>{setLogoData(ev.target.result);onLogoChange(ev.target.result);};reader.readAsDataURL(f);}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-semibold mb-4\",children:t('settings')}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-4 rounded shadow\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Upload Logo (PNG/JPG)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:upload,className:\"mt-2\"}),logoData&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsx(\"img\",{src:logoData,className:\"h-28\",alt:\"logo\"})})]})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","STR","en","addProduct","addCustomer","paidNow","remaining","previousPending","savePrint","products","customers","purchases","sales","reports","debits","settings","login","username","password","loginBtn","vendorName","modeOfPayment","cash","card","cheque","online","availableproducts","recycleBin","ur","App","lang","setLang","localStorage","getItem","route","setRoute","user","setUser","logo","setLogo","t","k","Login","onSuccess","u","titleMap","dashboard","RecycleBin","currentTitle","className","children","src","alt","map","_ref","value","label","onClick","concat","onChange","e","l","target","setItem","Dashboard","Products","Sales","Purchases","Reports","Debits","Settings","onLogoChange","Header","_ref2","removeItem","_ref3","setU","p","setP","err","setErr","submit","preventDefault","res","fetch","method","headers","body","JSON","stringify","ok","Error","j","json","onSubmit","placeholder","type","_ref4","activeTab","setActiveTab","setSales","selectedCustomerName","setSelectedCustomerName","loading","setLoading","logoUrl","stock","setStock","movements","setMovements","stockLoading","setStockLoading","stockErr","setStockErr","loadSales","loadStockData","message","console","error","pRes","sRes","Promise","all","pJson","sJson","salesData","mvts","forEach","lines","line","push","date","productName","bagWeight","Number","weight","bagsDelta","qty","quantity","s","loadStock","resStock","resMov","jStock","jMov","customerGroup","Map","name","customerName","has","set","invoices","totalGrand","totalPaid","entry","get","grandTotal","customersWithPending","Array","from","values","sortedInvoices","sort","a","b","Date","last","length","latestPending","pending","_objectSpread","totalPending","filter","selectedCustomer","find","c","stockSummaryMap","mv","bagWt","key","purchased","sold","row","bags","Math","abs","stockSummaryRows","r","available","localeCompare","maxStockValue","max","productTotalsMap","productTotals","maxProductValue","totalAvailableBags","reduce","sum","totalProductsInStock","lowStockCount","topProductsForBars","slice","printInvoiceForRecord","record","dateTime","toLocaleString","items","customerTotal","html","it","i","pricePerKg","price","lineTotal","toFixed","join","w","window","open","document","write","close","setTimeout","print","deleteSaleFromDashboard","id","confirm","alert","prev","inv","idx","style","width","title","_ref5","setName","setQuantity","list","setList","then","catch","add","prod","_ref6","setCustomers","productsList","setProductsList","selectedCustomerId","setSelectedCustomerId","setCustomerName","setPreviousPending","setItems","setPaidNow","calc","setCalc","salesRecords","setSalesRecords","editingIndex","setEditingIndex","editingId","setEditingId","prompt","location","prevList","customer","addItem","updateItem","copy","onSelectCustomer","x","calculate","printGate","printInvoice","saveAndPrint","customerId","j2","deleteSale","editSales","index","restoredItems","item","_ref7","_item$quantity","_item$weight","_ref8","_item$pricePerKg","VendorPurchaseManagement","_ref9","vendorsSummary","setVendorsSummary","selectedVendorName","setSelectedVendorName","loadVendorPurchases","g","groups","handleDeletePurchase","purchase","selectedVendorSummary","v","totalPendingAll","_ref0","setVendorName","rows","setRows","mode","setMode","records","setRecords","filterDate","setFilterDate","vendorMap","raw","parsed","parse","isArray","addRow","updateRow","total","savePurchase","payloadProducts","payload","updated","editPurchase","restoredRows","deletePurchase","displayedRecords","loadPurchases","_ref1","setDate","toISOString","report","setReport","loadReport","totalSales","totalReceived","productsSummary","totalQty","totalWeight","_ref10","_vendors$find$remaini","_vendors$find","vendors","setVendors","selectedVendorId","setSelectedVendorId","vendorPlace","setVendorPlace","vendorCompany","setVendorCompany","editingVendorId","setEditingVendorId","ledger","setLedger","txType","setTxType","txAmount","setTxAmount","txMethod","setTxMethod","txBillRef","setTxBillRef","txDate","setTxDate","editingTxId","setEditingTxId","purchaseDebits","setPurchaseDebits","loadingPurchases","setLoadingPurchases","loadVendors","loadPurchaseDebits","loadLedger","vendorId","vendor","onSelectVendor","resetTxForm","startNewVendor","startEditVendor","place","company","saveVendor","undefined","findIndex","deleteVendor","deletePurchaseDebit","startEditTx","tx","amount","billRef","saveTransaction","url","deleteTransaction","editPurchaseDebit","newPaidStr","String","newPaid","isNaN","arr","rec","totalGoods","selectedVendor","filteredPurchases","toLowerCase","toLocaleDateString","balanceAfter","colSpan","_ref11","activeType","setActiveType","loadItems","arguments","changeType","handleRestore","handleDelete","handleDeleteAll","renderMainLabel","formatDate","iso","_unused","charAt","toUpperCase","deletedAt","_ref12","logoData","setLogoData","upload","f","files","reader","FileReader","onload","ev","result","readAsDataURL","accept"],"sources":["/home/usman/Desktop/erp_system_talha_project/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nconst STR = {\n  en: {\n    addProduct: 'Add Product',\n    addCustomer: 'Add Customer',\n    paidNow: 'Paid Now',\n    remaining: 'Remaining',\n    previousPending: 'Previous Pending',\n    savePrint: 'Save & Print',\n    products: 'Products',\n    customers: 'Customers',\n    purchases: 'Purchases',\n    sales: 'Sales',\n    reports: 'Reports',\n    debits: 'Debits',\n    settings: 'Settings',\n    login: 'Welcome Back',\n    username: 'Username',\n    password: 'Password',\n    loginBtn: 'Login',\n    vendorName: 'Vendor Name',\n    modeOfPayment: 'Mode of Payment',\n    cash: 'Cash',\n    card: 'Card',\n    cheque: 'Cheque',\n    online: 'Online',\n    availableproducts : 'Available Products',\n    recycleBin: 'Recycle Bin',\n  },\n  ur: {\n    addProduct: 'مصنوع شامل کریں',\n    addCustomer: 'کسٹمر شامل کریں',\n    paidNow: 'ادائیگی',\n    remaining: 'بقیہ',\n    previousPending: 'پچھلا بقایا',\n    savePrint: 'محفوظ کریں اور پرنٹ کریں',\n    products: 'پراڈکٹس',\n    customers: 'کسٹمرز',\n    purchases: 'خریداری',\n    sales: 'فروخت',\n    reports: 'رپورٹس',\n    debits: 'ادائیگیاں',\n    settings: 'سیٹنگز',\n    login: 'لاگ ان کریں',\n    username: 'یوزر',\n    password: 'پاس ورڈ',\n    loginBtn: 'لاگ ان',\n    vendorName: 'سپلائر کا نام',\n    modeOfPayment: 'ادائیگی کا طریقہ',\n    cash: 'نقد',\n    card: 'کارڈ',\n    cheque: 'چیک',\n    online: 'آن لائن',\n    availableproducts : 'دستیاب مصنوعات',\n    recycleBin:'ری سائیکل بن',\n    login: 'خوش آمدید',\n  }\n};\nfunction App(){\n  const [lang, setLang] = useState(localStorage.getItem('erp_lang') || 'en');\n  const [route, setRoute] = useState('dashboard');\n  const [user, setUser] = useState(null);\n  const [logo, setLogo] = useState(localStorage.getItem('erp_logo') || '');\n\n  function t(k){ return STR[lang][k] || k; }\n\n  useEffect(()=>{ if(user) setRoute('dashboard'); }, [user]);\n\n  if(!user) {\n    return (\n      <Login\n        onSuccess={u=>{ setUser(u); }}\n        logo={logo}\n        t={t}\n        setLang={setLang}\n        lang={lang}\n      />\n    );\n  }\n\n  const titleMap = {\n    dashboard: 'Dashboard',\n    products: t('products'),\n    sales: t('sales'),\n    purchases: t('purchases'),\n    reports: t('reports'),\n    debits: t('debits'),\n    settings: t('settings'),\n    RecycleBin:t('Recycle Bin'),\n    \n  };\n  const currentTitle = titleMap[route] || 'Recycle Bin';\n\n  return (\n    <div className=\"min-h-screen flex bg-slate-100 text-slate-900\">\n      {/* LEFT PANEL / SIDEBAR */}\n      <aside className=\"w-64 bg-slate-950 text-slate-50 flex flex-col\">\n        {/* Top: DP + title */}\n        <div className=\"px-4 py-5 flex items-center gap-3 border-b border-slate-800\">\n          {logo ? (\n            <img\n              src={logo}\n              alt=\"DP\"\n              className=\"h-12 w-12 rounded-full object-cover ring-2 ring-cyan-400 shadow-md\"\n            />\n          ) : (\n            <div className=\"h-12 w-12 rounded-full bg-slate-800 flex items-center justify-center text-sm font-semibold\">\n              Recycle Bin\n            </div>\n          )}\n          <div>\n            <div className=\"font-semibold text-white\">Ethehad Traders</div>\n            <div className=\"text-xs text-cyan-400\">ET & Co</div>\n          </div>\n        </div>\n\n        {/* Menu */}\n        <nav className=\"flex-1 px-2 py-4 space-y-1\">\n          {[\n            ['dashboard', 'Dashboard'],\n            ['products', t('products')],\n            ['sales', t('sales')],\n            ['purchases', t('purchases')],\n            ['reports', t('reports')],\n            ['debits', t('debits')],\n            ['settings', t('settings')],\n            ['recycleBin', t('Recycle Bin')],\n          ].map(([value, label]) => (\n            <button\n              key={value}\n              onClick={() => setRoute(value)}\n              className={`w-full flex items-center px-3 py-2 rounded-lg text-sm text-left transition\n                ${\n                  route === value\n                    ? 'bg-gradient-to-r from-cyan-500/20 via-sky-500/10 to-transparent text-white border-l-4 border-cyan-400'\n                    : 'text-slate-300 hover:bg-slate-800/60'\n                }`}\n            >\n              {label}\n            </button>\n          ))}\n        </nav>\n\n        {/* Bottom: user + logout + language */}\n        <div className=\"px-4 py-4 border-t border-slate-800 text-xs text-slate-400 flex items-center justify-between\">\n          <span>{user?.username}</span>\n          <div className=\"flex items-center gap-2\">\n            <select\n              value={lang}\n              onChange={e=>{ const l=e.target.value; setLang(l); localStorage.setItem('erp_lang', l); }}\n              className=\"bg-slate-900 border border-slate-700 rounded px-1 py-0.5 text-xs\"\n            >\n              <option value=\"en\">EN</option>\n              <option value=\"ur\">UR</option>\n            </select>\n            <button\n              onClick={()=>{ setUser(null); setRoute('login'); }}\n              className=\"text-red-400 hover:text-red-300\"\n            >\n              Logout\n            </button>\n          </div>\n        </div>\n      </aside>\n\n      {/* MAIN AREA */}\n      <main className=\"flex-1 relative overflow-hidden\">\n        {/* Faded background DP / logo */}\n        {logo && (\n          <img\n            src={logo}\n            alt=\"background\"\n            className=\"pointer-events-none select-none absolute inset-0 w-full h-full object-cover opacity-10\"\n          />\n        )}\n\n        <div className=\"relative h-full p-6\">\n          {/* Glass top bar */}\n          <div className=\"mb-6 bg-white/80 backdrop-blur-xl shadow-lg rounded-2xl px-6 py-4\">\n            <h1 className=\"text-lg font-semibold text-slate-800\">\n              {currentTitle}\n            </h1>\n          </div>\n\n          {/* Page content */}\n          <div className=\"relative z-10\">\n            {route === 'dashboard' && <Dashboard t={t} />}\n            {route === 'products' && <Products t={t} />}\n            {route === 'sales' && <Sales t={t} />}\n            {route === 'purchases' && <Purchases t={t} />}\n            {route === 'reports' && <Reports t={t} />}\n            {route === 'debits' && <Debits t={t} />}\n            {route === 'recycleBin' && <RecycleBin t={t} />}\n            {route === 'settings' && <Settings t={t} onLogoChange={l=>{ setLogo(l); localStorage.setItem('erp_logo', l); }} />}\n            \n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\nfunction Header({ setRoute, setUser, logo, setLogo, lang, setLang, t }) {\n  return (\n    <header className=\"bg-white shadow mb-4\">\n      <div className=\"max-w-6xl mx-auto px-2 sm:px-4 md:px-6 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3\">\n        {/* Left: logo + title */}\n        <div className=\"flex items-center gap-3\">\n          {logo ? (\n            <img\n              src={logo}\n              alt=\"logo\"\n              className=\"h-10 w-10 object-contain\"\n            />\n          ) : (\n            <div className=\"h-10 w-10 bg-sky-100 rounded flex items-center justify-center text-sky-600\">\n              Logo\n            </div>\n          )}\n          <h1 className=\"text-lg md:text-xl font-semibold text-sky-600\">\n            ERP\n          </h1>\n        </div>\n\n        {/* Right: nav */}\n        <nav className=\"flex flex-wrap items-center gap-2\">\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('dashboard')}\n          >\n            {t('Dashboard')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('products')}\n          >\n            {t('products')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('sales')}\n          >\n            {t('sales')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('purchases')}\n          >\n            {t('purchases')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('reports')}\n          >\n            {t('reports')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('debits')}\n          >\n            {t('debits')}\n          </button>\n          <button\n            className=\"px-3 py-1 rounded-md hover:bg-sky-50 transition text-xs sm:text-sm\"\n            onClick={() => setRoute('settings')}\n          >\n            {t('settings')}\n          </button>\n\n          <select\n            value={lang}\n            onChange={e => {\n              setLang(e.target.value);\n              localStorage.setItem('erp_lang', e.target.value);\n            }}\n            className=\"border rounded px-2 py-1 text-xs sm:text-sm\"\n          >\n            <option value=\"en\">EN</option>\n            <option value=\"ur\">UR</option>\n          </select>\n\n          <button\n            className=\"px-3 py-1 rounded-md bg-sky-600 text-white hover:bg-sky-700 transition text-xs sm:text-sm\"\n            onClick={() => {\n              setUser(null);\n              localStorage.removeItem('erp_lang');\n            }}\n          >\n            {t('login')}\n          </button>\n        </nav>\n      </div>\n    </header>\n  );\n}\n//fuction login\n\nfunction Login({ onSuccess, logo, t, setLang, lang }){\n  const [u, setU] = useState('admin');\n  const [p, setP] = useState('admin');\n  const [err, setErr] = useState('');\n  \n\n\n  async function submit(e){\n    e.preventDefault();\n    try{\n      const res = await fetch('http://localhost:4000/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({ username: u, password: p })});\n      if(!res.ok) throw new Error('login failed');\n      const j = await res.json();\n      onSuccess(j.user);\n    }catch(err){\n      setErr('Wrong Password or Username');\n    }\n  }\n\n  return (\n    <div className=\"flex items-center justify-center py-12\">\n      <div className=\"w-full max-w-md bg-white rounded-xl shadow-md p-8\">\n        <div className=\"flex justify-center mb-4\">{logo? <img src={logo} className=\"h-24 w-24 object-contain\" alt=\"logo\"/> : <div className=\"h-24 w-24 bg-sky-100 rounded-full flex items-center justify-center text-sky-600\">Logo</div>}</div>\n        <h2 className=\"text-center text-xl font-semibold text-gray-700 mb-4\">{t('login')}</h2>\n        <form onSubmit={submit} className=\"space-y-4\">\n          <input placeholder={t('username')} className=\"w-full px-4 py-2 border rounded-md focus:outline-sky-300\" value={u} onChange={e=>setU(e.target.value)} />\n          <input type=\"password\" placeholder={t('password')} className=\"w-full px-4 py-2 border rounded-md focus:outline-sky-300\" value={p} onChange={e=>setP(e.target.value)} />\n          <div className=\"flex gap-2 items-center\">\n            <select value={lang} onChange={e=>{ setLang(e.target.value); localStorage.setItem('erp_lang', e.target.value); }} className=\"border p-1 rounded\">\n              <option value=\"en\">EN</option>\n              <option value=\"ur\">UR</option>\n            </select>\n            <button className=\"w-full py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition\">{t('loginBtn')}</button>\n          </div>\n        </form>\n        {err && <p className=\"text-red-500 mt-3\">{err}</p>}\n      </div>\n    </div>\n  );\n}\n\n/* Dashboard */\n\nfunction Dashboard({ t }) {\n  const [activeTab, setActiveTab] = useState(\"customers\"); // 'customers' | 'stock'\n  const [sales, setSales] = useState([]);\n  const [selectedCustomerName, setSelectedCustomerName] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState(\"\");\n  const logoUrl = localStorage.getItem(\"erp_logo\") || \"\";\n\n  // Stock-related state\n  const [stock, setStock] = useState([]);\n  const [movements, setMovements] = useState([]);\n  const [stockLoading, setStockLoading] = useState(false);\n  const [stockErr, setStockErr] = useState(\"\");\n\n  // Initial load\n  useEffect(() => {\n    loadSales();\n    loadStockData();\n  }, []);\n\n  // ---------------- SALES LOADING ----------------\n  async function loadSales() {\n    try {\n      setLoading(true);\n      setErr(\"\");\n      const res = await fetch(\"http://localhost:4000/api/sales\");\n      const j = await res.json();\n      if (!j.ok) {\n        setErr(j.message || \"Failed to load sales\");\n        return;\n      }\n      setSales(j.sales || []);\n    } catch (e) {\n      console.error(e);\n      setErr(\"Failed to load sales\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // --------------- STOCK LOADING (from purchases + sales) ---------------\n  async function loadStockData() {\n    try {\n      setStockLoading(true);\n      setStockErr(\"\");\n\n      const [pRes, sRes] = await Promise.all([\n        fetch(\"http://localhost:4000/api/purchases\"),\n        fetch(\"http://localhost:4000/api/sales\"),\n      ]);\n\n      const [pJson, sJson] = await Promise.all([pRes.json(), sRes.json()]);\n\n      if (!pJson.ok) throw new Error(pJson.message || \"Failed to load purchases\");\n      if (!sJson.ok) throw new Error(sJson.message || \"Failed to load sales\");\n\n      const purchases = pJson.purchases || [];\n      const salesData = sJson.sales || [];\n\n      const mvts = [];\n\n      // Purchases → increase stock\n      purchases.forEach((p) => {\n        (p.products || p.lines || []).forEach((line) => {\n          mvts.push({\n            date: p.date,\n            type: \"Purchase\",\n            productName: line.productName || \"\",\n            bagWeight: Number(line.weight || 0),\n            bagsDelta: Number(line.qty || line.quantity || 0),\n          });\n        });\n      });\n\n      // Sales → decrease stock\n      salesData.forEach((s) => {\n        (s.products || s.lines || []).forEach((line) => {\n          mvts.push({\n            date: s.date,\n            type: \"Sale\",\n            productName: line.productName || \"\",\n            bagWeight: Number(line.weight || 0),\n            bagsDelta: Number(line.quantity || line.qty || 0),\n          });\n        });\n      });\n\n      setMovements(mvts);\n      setStock(mvts); // optional, if you use `stock` elsewhere\n    } catch (e) {\n      console.error(e);\n      setStockErr(e.message || \"Failed to load stock data\");\n    } finally {\n      setStockLoading(false);\n    }\n  }\n\n  // OLD stock loader hitting /api/stock, /api/stock/movements (keep if you really need it)\n  async function loadStock() {\n    try {\n      setStockLoading(true);\n      setStockErr(\"\");\n\n      const [resStock, resMov] = await Promise.all([\n        fetch(\"http://localhost:4000/api/stock\"),\n        fetch(\"http://localhost:4000/api/stock/movements\"),\n      ]);\n\n      const jStock = await resStock.json();\n      const jMov = await resMov.json();\n\n      if (!jStock.ok) throw new Error(jStock.message || \"Failed stock\");\n      if (!jMov.ok) throw new Error(jMov.message || \"Failed movements\");\n\n      setStock(jStock.stock || []);\n      setMovements(jMov.movements || []);\n    } catch (e) {\n      console.error(e);\n      setStockErr(\"Failed to load stock info\");\n    } finally {\n      setStockLoading(false);\n    }\n  }\n\n  // ---------------- CUSTOMER GROUPING (latest pending only) ----------------\n  const customerGroup = new Map();\n\n  (sales || []).forEach((s) => {\n    const name = s.customerName || \"Unknown\";\n    if (!customerGroup.has(name)) {\n      customerGroup.set(name, {\n        customerName: name,\n        invoices: [],\n        totalGrand: 0,\n        totalPaid: 0,\n      });\n    }\n\n    const entry = customerGroup.get(name);\n    entry.invoices.push(s);\n    entry.totalGrand += Number(s.grandTotal || 0);\n    entry.totalPaid += Number(s.paidNow || 0);\n  });\n\n  const customersWithPending = Array.from(customerGroup.values())\n    .map((entry) => {\n      // sort by date to find LAST invoice\n      const sortedInvoices = [...entry.invoices].sort(\n        (a, b) => new Date(a.date || 0) - new Date(b.date || 0)\n      );\n      const last = sortedInvoices[sortedInvoices.length - 1];\n      const latestPending = Number(last?.pending || 0);\n\n      return {\n        ...entry,\n        invoices: sortedInvoices,\n        totalPending: latestPending, // only latest remaining counts\n      };\n    })\n    .filter((entry) => entry.totalPending > 0)\n    .sort((a, b) => b.totalPending - a.totalPending);\n\n  const selectedCustomer =\n    customersWithPending.find(\n      (c) => c.customerName === selectedCustomerName\n    ) || null;\n    \n\n    // === STOCK SUMMARY (per product + bag weight) ===\n  const stockSummaryMap = new Map();\n\n  (movements || []).forEach((mv) => {\n    const name = mv.productName || '';\n    const bagWt = Number(mv.bagWeight || mv.bagWt || 0);\n    if (!name || !bagWt) return;\n\n    const key = `${name}||${bagWt}`;\n    if (!stockSummaryMap.has(key)) {\n      stockSummaryMap.set(key, {\n        productName: name,\n        bagWeight: bagWt,\n        purchased: 0,\n        sold: 0,\n      });\n    }\n    const row = stockSummaryMap.get(key);\n\n    const qty = Number(mv.bagsDelta || mv.qty || mv.bags || 0);\n\n    if (mv.type === 'Purchase') {\n      row.purchased += Math.abs(qty);\n    } else if (mv.type === 'Sale') {\n      row.sold += Math.abs(qty);\n    }\n  });\n\n  // rows by product + bag weight\n  const stockSummaryRows = Array.from(stockSummaryMap.values())\n    .map((r) => ({\n      ...r,\n      available: r.purchased - r.sold,\n    }))\n    .sort(\n      (a, b) =>\n        a.productName.localeCompare(b.productName) ||\n        a.bagWeight - b.bagWeight\n    );\n\n  const maxStockValue =\n    stockSummaryRows.length === 0\n      ? 1\n      : Math.max(\n          ...stockSummaryRows.map((r) =>\n            Math.max(r.purchased, r.sold, r.available)\n          ),\n          1\n        );\n\n  // === AGGREGATE BY PRODUCT (ignore bag weight) ===\n  const productTotalsMap = new Map();\n  stockSummaryRows.forEach((r) => {\n    if (!productTotalsMap.has(r.productName)) {\n      productTotalsMap.set(r.productName, {\n        productName: r.productName,\n        purchased: 0,\n        sold: 0,\n        available: 0,\n      });\n    }\n    const entry = productTotalsMap.get(r.productName);\n    entry.purchased += r.purchased;\n    entry.sold += r.sold;\n    entry.available += r.available;\n  });\n\n  const productTotals = Array.from(productTotalsMap.values()).sort(\n    (a, b) => b.available - a.available\n  );\n\n  const maxProductValue =\n    productTotals.length === 0\n      ? 1\n      : Math.max(\n          ...productTotals.map((p) =>\n            Math.max(p.purchased, p.sold, p.available)\n          ),\n          1\n        );\n\n  const totalAvailableBags = productTotals.reduce(\n    (sum, p) => sum + Math.max(p.available, 0),\n    0\n  );\n\n  const totalProductsInStock = productTotals.filter(\n    (p) => p.available > 0\n  ).length;\n\n  // simple low-stock rule: available > 0 and <= 20 bags\n  const lowStockCount = productTotals.filter(\n    (p) => p.available > 0 && p.available <= 20\n  ).length;\n\n  // show only top N in the big bars (to avoid mess)\n  const topProductsForBars = productTotals.slice(0, 8);\n  // ================= STOCK SUMMARY (per product + bag weight) =================   \n\n  \n\n  // ---------------- PRINT / DELETE HELPERS ----------------\n  function printInvoiceForRecord(record) {\n    if (!record) return;\n\n    const dateTime = record.date\n      ? new Date(record.date).toLocaleString()\n      : new Date().toLocaleString();\n\n    const items = record.products || record.lines || [];\n    const customerTotal = Number(record.customerTotal || 0);\n    const previousPending = Number(record.previousPending || 0);\n    const grandTotal = Number(record.grandTotal || 0);\n    const paidNow = Number(record.paidNow || 0);\n    const remaining = Number(record.pending || 0);\n\n    const html = `\n      <html><body>\n      <img src='${logoUrl}' style='display:block;margin:0 auto;width:180px;opacity:0.9' />\n      <h2 style='text-align:center'>Invoice</h2>\n      <div>Customer: ${record.customerName || ''}</div>\n      <div>Date &amp; Time: ${dateTime}</div>\n      <table border='1' style='width:100%;border-collapse:collapse'>\n        <tr>\n          <th>#</th>\n          <th>Product</th>\n          <th>Qty</th>\n          <th>Weight</th>\n          <th>Price</th>\n          <th>Line Total</th>\n        </tr>\n        ${items\n          .map(\n            (it, i) => `\n          <tr>\n            <td>${i + 1}</td>\n            <td>${it.productName || ''}</td>\n            <td>${it.quantity || it.qty || 0}</td>\n            <td>${it.weight || 0}</td>\n            <td>${it.pricePerKg || it.price || 0}</td>\n            <td>${Number(\n              it.lineTotal ||\n                Number(it.quantity || it.qty || 0) *\n                  \n                  Number(it.pricePerKg || it.price || 0)\n            ).toFixed(2)}</td>\n          </tr>`\n          )\n          .join('')}\n      </table>\n      <h3>Customer Total: ${customerTotal.toFixed(2)}</h3>\n      <div>Previous Pending: ${previousPending.toFixed(2)}</div>\n      <div>Grand Total: ${grandTotal.toFixed(2)}</div>\n      <div>Paid: ${paidNow.toFixed(2)}</div>\n      <div>Remaining: ${remaining.toFixed(2)}</div>\n      </body></html>\n    `;\n\n    const w = window.open(\"\", \"_blank\");\n    w.document.write(html);\n    w.document.close();\n    setTimeout(() => w.print(), 300);\n  }\n\n  async function deleteSaleFromDashboard(id) {\n    if (!window.confirm(\"Delete this sale?\")) return;\n    try {\n      const res = await fetch(`http://localhost:4000/api/sales/${id}`, {\n        method: \"DELETE\",\n      });\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || \"Failed to delete sale\");\n        return;\n      }\n      setSales((prev) => prev.filter((s) => s.id !== id));\n    } catch (e) {\n      console.error(e);\n      alert(\"Error deleting sale\");\n    }\n  }\n\n  // ---------------- JSX ----------------\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">Dashboard</h2>\n\n      {/* Tabs */}\n      <div className=\"flex mb-4 gap-2\">\n        <button\n          onClick={() => setActiveTab(\"customers\")}\n          className={\n            \"px-4 py-2 rounded text-sm \" +\n            (activeTab === \"customers\"\n              ? \"bg-sky-600 text-white\"\n              : \"bg-white text-sky-700 border\")\n          }\n        >\n          Customer Records\n        </button>\n        <button\n          onClick={() => setActiveTab(\"stock\")}\n          className={\n            \"px-4 py-2 rounded text-sm \" +\n            (activeTab === \"stock\"\n              ? \"bg-sky-600 text-white\"\n              : \"bg-white text-sky-700 border\")\n          }\n        >\n          Stocks Updates\n        </button>\n\n        {/* Top-right refresh – refreshes CURRENT tab only */}\n        <button\n          onClick={() => {\n            if (activeTab === \"customers\") {\n              loadSales();\n            } else if (activeTab === \"stock\") {\n              loadStockData(); // use stockData version\n            }\n          }}\n          className=\"ml-auto px-3 py-2 text-xs bg-gray-100 border rounded hover:bg-gray-200\"\n        >\n          Refresh\n        </button>\n      </div>\n\n      {/* Loading / Error per tab */}\n      {activeTab === \"customers\" && loading && (\n        <p className=\"text-sm text-gray-500 mb-2\">Loading sales…</p>\n      )}\n      {activeTab === \"customers\" && err && (\n        <p className=\"text-sm text-red-600 mb-2\">{err}</p>\n      )}\n\n      {activeTab === \"stock\" && stockLoading && (\n        <p className=\"text-sm text-gray-500 mb-2\">Loading stock…</p>\n      )}\n      {activeTab === \"stock\" && stockErr && (\n        <p className=\"text-sm text-red-600 mb-2\">{stockErr}</p>\n      )}\n\n      {/* ===================== Customer Records Tab ===================== */}\n      {activeTab === \"customers\" && (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n          {/* Left: Customers with remaining */}\n          <div className=\"bg-white p-4 rounded shadow lg:col-span-1\">\n            <h3 className=\"font-semibold mb-2 text-sm\">\n              Customers with Remaining Amount\n            </h3>\n\n            {customersWithPending.length === 0 ? (\n              <p className=\"text-xs text-gray-500\">\n                No customers with pending amounts.\n              </p>\n            ) : (\n              <table className=\"w-full text-xs\">\n                <thead className=\"bg-gray-100\">\n                  <tr>\n                    <th className=\"p-2 text-left\">Customer</th>\n                    <th className=\"p-2 text-right\">Pending</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {customersWithPending.map((c) => (\n                    <tr\n                      key={c.customerName}\n                      className={\n                        \"border-t cursor-pointer \" +\n                        (c.customerName === selectedCustomerName\n                          ? \"bg-sky-50\"\n                          : \"\")\n                      }\n                      onClick={() => setSelectedCustomerName(c.customerName)}\n                    >\n                      <td className=\"p-2\">{c.customerName}</td>\n                      <td className=\"p-2 text-right\">\n                        {c.totalPending.toFixed(2)}\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n\n          {/* Right: Selected customer details */}\n          <div className=\"bg-white p-4 rounded shadow lg:col-span-2\">\n            {!selectedCustomer ? (\n              <p className=\"text-sm text-gray-500\">\n                Select a customer on the left to see full record of their\n                purchases, paid amounts, and remaining balance.\n              </p>\n            ) : (\n              <>\n                {/* summary header */}\n                <div className=\"flex flex-wrap justify-between mb-3 text-sm\">\n                  <div>\n                    <div className=\"font-semibold\">\n                      {selectedCustomer.customerName}\n                    </div>\n                    <div className=\"text-gray-500 text-xs\">\n                      Total Pending:{\" \"}\n                      <strong>\n                        {selectedCustomer.totalPending.toFixed(2)}\n                      </strong>\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-right space-y-1\">\n                    <div>\n                      Total Grand:{\" \"}\n                      <strong>\n                        {selectedCustomer.totalGrand.toFixed(2)}\n                      </strong>\n                    </div>\n                    <div>\n                      Total Paid:{\" \"}\n                      <strong>\n                        {selectedCustomer.totalPaid.toFixed(2)}\n                      </strong>\n                    </div>\n                  </div>\n                </div>\n\n                {/* invoices for this customer */}\n                {selectedCustomer.invoices.map((inv) => (\n                  <div\n                    key={inv.id}\n                    className=\"border rounded mb-3 p-3 text-xs\"\n                  >\n                    <div className=\"flex flex-wrap justify-between mb-1\">\n                      <div>\n                        <span className=\"font-semibold\">Date: </span>\n                        {inv.date}\n                      </div>\n                      <div>\n                        <span className=\"font-semibold\">Grand: </span>\n                        {inv.grandTotal} &nbsp; | &nbsp;\n                        <span className=\"font-semibold\">Paid: </span>\n                        {inv.paidNow} &nbsp; | &nbsp;\n                        <span className=\"font-semibold\">Remaining: </span>\n                        {inv.pending}\n                      </div>\n                    </div>\n\n                    {/* Products table */}\n                    <table className=\"w-full text-[11px] border mt-1\">\n                      <thead className=\"bg-gray-100\">\n                        <tr>\n                          <th className=\"border px-1 py-0.5\">#</th>\n                          <th className=\"border px-1 py-0.5\">Product</th>\n                          <th className=\"border px-1 py-0.5\">Qty</th>\n                          <th className=\"border px-1 py-0.5\">Weight</th>\n                          <th className=\"border px-1 py-0.5\">Price</th>\n                          <th className=\"border px-1 py-0.5\">Line Total</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {(inv.products || inv.lines || []).map((p, idx) => (\n                          <tr key={idx}>\n                            <td className=\"border px-1 py-0.5\">{idx + 1}</td>\n                            <td className=\"border px-1 py-0.5\">\n                              {p.productName}\n                            </td>\n                            <td className=\"border px-1 py-0.5\">\n                              {p.quantity || p.qty}\n                            </td>\n                            <td className=\"border px-1 py-0.5\">\n                              {p.weight}\n                            </td>\n                            <td className=\"border px-1 py-0.5\">\n                              {p.pricePerKg || p.price}\n                            </td>\n                            <td className=\"border px-1 py-0.5\">\n                              {p.lineTotal}\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </table>\n\n                    {/* Actions */}\n                    <div className=\"mt-2 flex justify-end gap-2\">\n                      <button\n                        onClick={() => printInvoiceForRecord(inv)}\n                        className=\"px-2 py-1 bg-indigo-600 text-white rounded\"\n                      >\n                        Print Invoice\n                      </button>\n                      <button\n                        onClick={() => deleteSaleFromDashboard(inv.id)}\n                        className=\"px-2 py-1 bg-red-600 text-white rounded\"\n                      >\n                        🗑 Delete\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </>\n            )}\n          </div>\n        </div>\n      )}\n            {/* ===================== Stock Updates Tab ===================== */}\n      {activeTab === 'stock' && (\n        <div className=\"bg-white p-4 rounded shadow\">\n          {/* Header + refresh */}\n          <div className=\"flex items-center mb-4\">\n            <h3 className=\"font-semibold text-base\">Stock Updates</h3>\n            <button\n              onClick={loadStockData}\n              className=\"ml-auto px-3 py-1 text-xs border rounded hover:bg-gray-50\"\n            >\n              Refresh\n            </button>\n          </div>\n\n          {/* Loading / error */}\n          {stockLoading && (\n            <p className=\"text-xs text-gray-500 mb-2\">Loading stock…</p>\n          )}\n          {stockErr && (\n            <p className=\"text-xs text-red-600 mb-2\">{stockErr}</p>\n          )}\n\n          {/* ===== KPI cards ===== */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6 text-sm\">\n            <div className=\"border rounded-lg px-3 py-2 bg-sky-50\">\n              <div className=\"text-[11px] text-sky-700 uppercase\">\n                Total Products in Stock\n              </div>\n              <div className=\"text-xl font-semibold\">\n                {totalProductsInStock}\n              </div>\n            </div>\n            <div className=\"border rounded-lg px-3 py-2 bg-emerald-50\">\n              <div className=\"text-[11px] text-emerald-700 uppercase\">\n                Total Available Bags\n              </div>\n              <div className=\"text-xl font-semibold\">\n                {totalAvailableBags}\n              </div>\n            </div>\n            <div className=\"border rounded-lg px-3 py-2 bg-amber-50\">\n              <div className=\"text-[11px] text-amber-700 uppercase\">\n                Low Stock Items (&le; 20 bags)\n              </div>\n              <div className=\"text-xl font-semibold\">\n                {lowStockCount}\n              </div>\n            </div>\n          </div>\n\n          {stockSummaryRows.length === 0 ? (\n            <p className=\"text-xs text-gray-500\">\n              No stock calculated yet. Add some purchases / sales first.\n            </p>\n          ) : (\n            <>\n              {/* ===== Main layout: table + bars ===== */}\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Left: grouped table by product & bag weight */}\n                <div>\n                  <h4 className=\"font-semibold text-sm mb-2\">\n                    Available Stock (by product &amp; bag weight)\n                  </h4>\n                  <table className=\"w-full text-xs mb-4\">\n                    <thead className=\"bg-gray-100\">\n                      <tr>\n                        <th className=\"p-2 text-left\">Product</th>\n                        <th className=\"p-2 text-right\">Bag Wt</th>\n                        <th className=\"p-2 text-right\">Purchased</th>\n                        <th className=\"p-2 text-right\">Sold</th>\n                        <th className=\"p-2 text-right\">Available</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {stockSummaryRows.map((r) => (\n                        <tr\n                          key={`${r.productName}-${r.bagWeight}`}\n                          className=\"border-t\"\n                        >\n                          <td className=\"p-2\">{r.productName}</td>\n                          <td className=\"p-2 text-right\">{r.bagWeight}</td>\n                          <td className=\"p-2 text-right\">{r.purchased}</td>\n                          <td className=\"p-2 text-right\">{r.sold}</td>\n                          <td\n                            className={\n                              'p-2 text-right ' +\n                              (r.available < 0\n                                ? 'text-red-600 font-semibold'\n                                : '')\n                            }\n                          >\n                            {r.available}\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n\n                {/* Right: bar “charts” per product (aggregated) */}\n                <div>\n                  <h4 className=\"font-semibold text-sm mb-2\">\n                    Stock Overview by Product (bags)\n                  </h4>\n\n                  {topProductsForBars.length === 0 ? (\n                    <p className=\"text-xs text-gray-500\">\n                      No products with stock yet.\n                    </p>\n                  ) : (\n                    <div className=\"space-y-3\">\n                      {topProductsForBars.map((p) => (\n                        <div key={`prod-bar-${p.productName}`}>\n                          <div className=\"flex justify-between text-[11px] mb-1\">\n                            <span>{p.productName}</span>\n                            <span>Available: {p.available}</span>\n                          </div>\n\n                          <div className=\"h-3 bg-gray-100 rounded overflow-hidden flex\">\n                            {/* Purchased – blue */}\n                            <div\n                              style={{\n                                width:\n                                  (p.purchased / maxProductValue) * 100 + '%',\n                              }}\n                              className=\"bg-blue-500\"\n                              title={`Purchased: ${p.purchased}`}\n                            />\n                            {/* Sold – red */}\n                            <div\n                              style={{\n                                width:\n                                  (p.sold / maxProductValue) * 100 + '%',\n                              }}\n                              className=\"bg-red-400\"\n                              title={`Sold: ${p.sold}`}\n                            />\n                            {/* Available – green */}\n                            <div\n                              style={{\n                                width:\n                                  (Math.max(p.available, 0) /\n                                    maxProductValue) *\n                                    100 + '%',\n                              }}\n                              className=\"bg-green-500\"\n                              title={`Available: ${p.available}`}\n                            />\n                          </div>\n\n                          <div className=\"flex justify-between text-[10px] text-gray-500 mt-0.5\">\n                            <span>Purchased: {p.purchased}</span>\n                            <span>Sold: {p.sold}</span>\n                            <span>Available: {p.available}</span>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n\n                  {/* small legend */}\n                  <div className=\"flex gap-3 text-[10px] text-gray-500 mt-3\">\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-blue-500 inline-block rounded-sm\" />{' '}\n                      Purchased\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-red-400 inline-block rounded-sm\" />{' '}\n                      Sold\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <span className=\"w-3 h-3 bg-green-500 inline-block rounded-sm\" />{' '}\n                      Available\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* Products */\nfunction Products({ t }){\n  const [name, setName] = useState('');\n  const [quantity, setQuantity] = useState(1);\n  const [list, setList] = useState([]);\n  useEffect(()=>{ fetch('http://localhost:4000/5api/products').then(r=>r.json()).then(j=>setList(j.products||[])).catch(()=>{}); },[]);\n  async function add(){ if(!name) return alert('Enter product name'); const res = await fetch('http://localhost:4000/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({ name, quantity })}); const j = await res.json(); if(j.ok){ setList(prev=>[...prev, j.prod]); setName(''); setQuantity(1); } }\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">{t('products')}</h2>\n      <div className=\"bg-white p-4 rounded shadow mb-4\">\n        <div className=\"grid grid-cols-3 gap-2\">\n          <input placeholder=\"Product name\" value={name} onChange={e=>setName(e.target.value)} className=\"border p-2 rounded\" />\n          <input type=\"number\" value={quantity} onChange={e=>setQuantity(Number(e.target.value))} className=\"border p-2 rounded\" />\n          <button onClick={add} className=\"bg-sky-600 text-white px-4 rounded hover:bg-sky-700 transition\">{t('addProduct')}</button>\n        </div>\n      </div>\n      <div className=\"bg-white p-4 rounded shadow\">\n        <h3 className=\"font-semibold mb-2\">Available Products</h3>\n        <table className=\"w-full\"><thead><tr><th>ID</th><th>Name</th><th>Qty</th></tr></thead><tbody>{list.map(p=>(<tr key={p.id}><td className=\"p-2\">{p.id}</td><td>{p.name}</td><td>{p.quantity}</td></tr>))}</tbody></table>\n      </div>\n    </div>\n  );\n}\n\n function Sales({ t }) {\n  const [customers, setCustomers] = useState([]);\n  const [productsList, setProductsList] = useState([]);\n  const [selectedCustomerId, setSelectedCustomerId] = useState('');\n  const [customerName, setCustomerName] = useState('');\n  const [previousPending, setPreviousPending] = useState(0);\n  const [items, setItems] = useState([\n    { productName: '', quantity: 1, weight: 0, pricePerKg: 0 },\n  ]);\n  const [paidNow, setPaidNow] = useState(0);\n  const [calc, setCalc] = useState(null);\n  const [salesRecords, setSalesRecords] = useState([]);\n  const [editingIndex, setEditingIndex] = useState(null);\n  const [editingId, setEditingId] = useState(null);\n  useEffect(() => {\n    fetch('http://localhost:4000/api/customers')\n      .then((r) => r.json())\n      .then((j) => setCustomers(j.customers || []))\n      .catch(() => {});\n\n    fetch('http://localhost:4000/api/products')\n      .then((r) => r.json())\n      .then((j) => setProductsList(j.products || []))\n      .catch(() => {});\n\n    // load existing sales for list + delete\n    fetch('http://localhost:4000/api/sales')\n      .then((r) => r.json())\n      .then((j) => {\n        if (j.ok) setSalesRecords(j.sales || []);\n      })\n      .catch(() => {});\n  }, []);\n\n  function addCustomer() {\n    const name = prompt('Customer name');\n    if (!name) return;\n    const location = prompt('Location') || '';\n    const prev = Number(prompt('Previous Pending') || 0);\n    fetch('http://localhost:4000/api/customers', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name, location, previousPending: prev }),\n    })\n      .then((r) => r.json())\n      .then((j) => {\n        if (j.ok) {\n          setCustomers((prevList) => [...prevList, j.customer]);\n          alert('Customer added');\n        }\n      });\n  }\n\n  function addItem() {\n    setItems((prev) => [\n      ...prev,\n      { productName: '', quantity: 1, weight: 0, pricePerKg: 0 },\n    ]);\n  }\n\n  function updateItem(i, key, value) {\n    const copy = [...items];\n    copy[i][key] = value;\n    setItems(copy);\n  }\n\n  function onSelectCustomer(id) {\n    setSelectedCustomerId(id);\n    if (!id) {\n      setPreviousPending(0);\n      setCustomerName('');\n      return;\n    }\n    const c = customers.find((x) => x.id === Number(id));\n    if (c) {\n      setCustomerName(c.name);\n      setPreviousPending(c.previousPending || 0);\n    }\n  }\n  async function calculate() {\n    const res = await fetch('http://localhost:4000/api/calculate-invoice', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ products: items, previousPending }),\n    });\n    const j = await res.json();\n    setCalc(j);\n    // paidNow + remaining are always derived below, so when you hit Calculate\n    // it recomputes customerTotal -> grandTotal -> remaining\n  }\n  // ---- totals / derived values ----\n  const customerTotal =\n    calc && typeof calc.customerTotal !== 'undefined'\n      ? Number(calc.customerTotal || 0)\n      : items.reduce(\n          (s, it) =>\n            s +\n            Number(it.quantity || 0) *\n              \n              Number(it.pricePerKg || 0),\n          0\n        );\n\n  const grandTotal = +(customerTotal + Number(previousPending || 0)).toFixed(\n    2\n  );\n  const remaining = +(grandTotal - Number(paidNow || 0)).toFixed(2);\n  const logoUrl = localStorage.getItem('erp_logo') || '';\n    function printGate() {\n    const html = `\n      <html><body>\n      <img src='${logoUrl}' style='display:block;margin:0 auto;width:220px;opacity:0.9' />\n      <h2 style='text-align:center'>Gate Pass</h2>\n      <div>Customer: ${customerName}</div>\n      <div>Time: ${new Date().toLocaleString()}</div>\n      <table border='1' style='width:100%;border-collapse:collapse'>\n        <tr>\n          <th>#</th>\n          <th>Product</th>\n          <th>Weight</th>\n          <th>Qty</th>\n        </tr>\n        ${items.map((it, i) =>\n          `<tr>\n            <td>${i + 1}</td>\n            <td>${it.productName}</td>\n            <td>${it.quantity}</td>\n            <td>${it.weight}</td>\n          </tr>`\n        ).join('')}\n      </table>\n      </body></html>`;\n    const w = window.open('', '_blank');\n    w.document.write(html);\n    w.document.close();\n    setTimeout(() => w.print(), 300);\n  }\n\n  function printInvoice(record) {\n    const dateTime =\n      record && record.date\n        ? new Date(record.date).toLocaleString()\n        : new Date().toLocaleString();\n\n    const html = `\n      <html><body>\n      <img src='${logoUrl}' style='display:block;margin:0 auto;width:180px;opacity:0.9' />\n      <h2 style='text-align:center'>Invoice</h2>\n      <div>Customer: ${customerName}</div>\n      <div>Date &amp; Time: ${dateTime}</div>\n      <table border='1' style='width:100%;border-collapse:collapse'>\n        <tr>\n          <th>#</th>\n          <th>Product</th>\n          <th>Qty</th>\n          <th>Weight</th>\n          <th>Price</th>\n          <th>Line Total</th>\n        </tr>\n        ${items\n          .map(\n            (it, i) => `\n          <tr>\n            <td>${i + 1}</td>\n            <td>${it.productName}</td>\n            <td>${it.quantity}</td>\n            <td>${it.weight}</td>\n            <td>${it.pricePerKg}</td>\n            <td>${(\n              Number(it.quantity || 0) *\n              Number(it.weight || 0) *\n              Number(it.pricePerKg || 0)\n            ).toFixed(2)}</td>\n          </tr>`\n          )\n          .join('')}\n      </table>\n      <h3>Customer Total: ${customerTotal.toFixed(2)}</h3>\n      <div>Previous Pending: ${Number(previousPending || 0).toFixed(2)}</div>\n      <div>Grand Total: ${grandTotal.toFixed(2)}</div>\n      <div>Paid: ${Number(paidNow || 0).toFixed(2)}</div>\n      <div>Remaining: ${remaining.toFixed(2)}</div>\n      </body></html>\n    `;\n    const w = window.open('', '_blank');\n    w.document.write(html);\n    w.document.close();\n    setTimeout(() => w.print(), 300);\n  }\n\n  async function saveAndPrint() {\n    const res = await fetch('http://localhost:4000/api/save-sale', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        customerId: selectedCustomerId,\n        customerName,\n        previousPending,\n        products: items,\n        paidNow,\n      }),\n    });\n    const j = await res.json();\n    if (j.ok) {\n      alert(\n        'Saved. Remaining added to customer previous pending: ' +\n          j.record.pending\n      );\n      setSalesRecords((prev) => [...prev, j.record]);\n      fetch('http://localhost:4000/api/customers')\n        .then((r) => r.json())\n        .then((j2) => setCustomers(j2.customers || []))\n        .catch(() => {});\n      printInvoice(j.record); // only invoice window, not whole page\n    }\n  }\n\n  async function deleteSale(id) {\n    if (!window.confirm('Delete this sale?')) return;\n    const res = await fetch(`http://localhost:4000/api/sales/${id}`, {\n      method: 'DELETE',\n    });\n    const j = await res.json();\n    if (j.ok) {\n      setSalesRecords((prev) => prev.filter((s) => s.id !== id));\n    } else {\n      alert('Failed to delete sale');\n    }\n  }\n   \n  /* Sales Edit Function *//* Sales Edit Function */\n\n/* Sales Edit Function */\nfunction editSales(index) {\n  const s = salesRecords[index];\n  if (!s) return;\n\n  // Customer info\n  setSelectedCustomerId(s.customerId || \"\");\n  setCustomerName(s.customerName || \"\");\n  setPreviousPending(Number(s.previousPending || 0));\n  setPaidNow(Number(s.paidNow || 0));\n\n  // Items restore\n  const restoredItems = (s.products || s.lines || []).map((item) => ({\n    productName: item.productName || \"\",\n    quantity: Number(item.quantity ?? item.qty ?? 0),\n    weight: Number(item.weight ?? 0),\n    pricePerKg: Number(item.pricePerKg ?? item.price ?? 0),\n  }));\n\n  setItems(\n    restoredItems.length\n      ? restoredItems\n      : [{ productName: \"\", quantity: 1, weight: 0, pricePerKg: 0 }]\n  );\n\n  setEditingIndex(index);\n}\n\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">Sales / Invoice</h2>\n      {/* Customer selection */}\n      <div className=\"bg-white/80 p-4 rounded shadow mb-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\n          <select\n            className=\"border p-2 rounded\"\n            value={selectedCustomerId}\n            onChange={(e) => onSelectCustomer(e.target.value)}\n          >\n            <option value=\"\">Select Customer</option>\n            {customers.map((c) => (\n              <option key={c.id} value={c.id}>\n                {c.name} - {c.location}\n              </option>\n            ))}\n          </select>\n          <input\n            placeholder=\"Customer Name\"\n            value={customerName}\n            onChange={(e) => setCustomerName(e.target.value)}\n            className=\"border p-2 rounded\"\n          />\n          <input\n            type=\"number\"\n            placeholder=\"Previous Pending\"\n            value={previousPending}\n            onChange={(e) => setPreviousPending(Number(e.target.value))}\n            className=\"border p-2 rounded\"\n          />\n        </div>\n        <div className=\"mt-3\">\n          <button\n            onClick={addCustomer}\n            className=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm\"\n          >\n            {t('addCustomer')}\n          </button>\n        </div>\n      </div>\n\n      {/* Items table */}\n      <div className=\"bg-white/80 p-4 rounded shadow mb-4\">\n        <table className=\"w-full text-sm\">\n          <thead className=\"bg-sky-100\">\n            <tr>\n              <th className=\"p-2 text-left\">#</th>\n              <th className=\"p-2 text-left\">Product</th>\n              <th className=\"p-2 text-right\">Qty</th>\n              <th className=\"p-2 text-right\">Weight</th>\n              <th className=\"p-2 text-right\">Price</th>\n              <th className=\"p-2 text-right\">Line Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((it, i) => (\n              <tr key={i} className=\"border-t\">\n                <td className=\"p-2\">{i + 1}</td>\n                <td className=\"p-2\">\n                  <input\n                    className=\"border p-1 rounded w-full\"\n                    value={it.productName}\n                    onChange={(e) =>\n                      updateItem(i, 'productName', e.target.value)\n                    }\n                    list=\"products-list\"\n                  />\n                </td>\n                <td className=\"p-2 text-right\">\n                  <input\n                    className=\"border p-1 rounded w-20 text-right\"\n                    type=\"number\"\n                    value={it.quantity}\n                    onChange={(e) =>\n                      updateItem(i, 'quantity', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2 text-right\">\n                  <input\n                    className=\"border p-1 rounded w-24 text-right\"\n                    type=\"number\"\n                    value={it.weight}\n                    onChange={(e) =>\n                      updateItem(i, 'weight', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2 text-right\">\n                  <input\n                    className=\"border p-1 rounded w-24 text-right\"\n                    type=\"number\"\n                    value={it.pricePerKg}\n                    onChange={(e) =>\n                      updateItem(i, 'pricePerKg', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2 text-right\">\n                  {(\n                    Number(it.quantity || 0) *\n                    Number(it.weight || 0) *\n                    Number(it.pricePerKg || 0)\n                  ).toFixed(2)}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        <datalist id=\"products-list\">\n          {productsList.map((p) => (\n            <option key={p.id} value={p.name} />\n          ))}\n        </datalist>\n\n        <div className=\"flex flex-wrap items-center gap-3 mt-4\">\n          <button\n            onClick={addItem}\n            className=\"px-3 py-1 bg-white border rounded hover:shadow transition text-sm\"\n          >\n            ➕ Add Item\n          </button>\n          <button\n            onClick={calculate}\n            className=\"px-3 py-1 bg-sky-600 text-white rounded hover:bg-sky-700 transition text-sm\"\n          >\n            Calculate\n          </button>\n          \n          <div className=\"ml-auto flex flex-wrap items-center gap-2\">\n            <label className=\"text-sm\">Paid Now</label>\n            <input\n              type=\"number\"\n              value={paidNow}\n              onChange={(e) => setPaidNow(Number(e.target.value))}\n              className=\"border p-1 rounded w-28 text-right\"\n            />\n            <button\n              onClick={saveAndPrint}\n              className=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition text-sm\"\n            >\n              {t('savePrint')}\n            </button>\n          </div>\n          \n<button\n            onClick={printGate}\n            className=\"px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-800 transition text-sm\"\n          >\n            Gate Pass\n          </button>\n        </div>\n        \n\n        {/* Summary */}\n        <div className=\"mt-4 p-3 bg-gray-50 rounded text-sm space-y-1\">\n          <div>\n            Customer Total:{' '}\n            <strong>{customerTotal.toFixed(2)}</strong>\n          </div>\n          <div>\n            Previous Pending:{' '}\n            <strong>{Number(previousPending || 0).toFixed(2)}</strong>\n          </div>\n          <div>\n            Grand Total:{' '}\n            <strong>{grandTotal.toFixed(2)}</strong>\n          </div>\n          <div>\n            Paid Now:{' '}\n            <strong>{Number(paidNow || 0).toFixed(2)}</strong>\n          </div>\n          <div>\n            Remaining:{' '}\n            <strong>{remaining.toFixed(2)}</strong>\n          </div>\n        </div>\n      </div>\n\n      {/* Saved sales list */}\n      <div className=\"bg-white/80 p-4 rounded shadow\">\n        <h3 className=\"font-semibold mb-2 text-sm\">Saved Invoices</h3>\n        {salesRecords.length === 0 ? (\n          <p className=\"text-xs text-gray-500\">No invoices saved yet.</p>\n        ) : (\n          <table className=\"w-full text-xs\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"p-2 text-left\">#</th>\n                <th className=\"p-2 text-left\">Customer</th>\n                <th className=\"p-2 text-left\">Date/Time</th>\n                <th className=\"p-2 text-right\">Grand Total</th>\n                <th className=\"p-2 text-right\">Paid</th>\n                <th className=\"p-2 text-right\">Remaining</th>\n                <th className=\"p-2 text-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {salesRecords.map((s, idx) => (\n                <tr key={s.id} className=\"border-t\">\n                  <td className=\"p-2\">{idx + 1}</td>\n                  <td className=\"p-2\">{s.customerName}</td>\n                  <td className=\"p-2\">{s.date}</td>\n                  <td className=\"p-2 text-right\">{s.grandTotal}</td>\n                  <td className=\"p-2 text-right\">{s.paidNow}</td>\n                  <td className=\"p-2 text-right\">{s.pending}</td>\n                  <td className=\"p-2 text-center\">\n  <button\n    onClick={() => editSales(idx)}\n    className=\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\"\n  >\n    Action\n  </button>\n\n  <button\n    onClick={() => deleteSale(s.id)}\n    className=\"px-2 py-1 text-xs bg-red-600 text-white rounded\"\n  >\n    🗑\n  </button>\n</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        )}\n      </div>\n    </div>\n  );\n}\n/* ================= Vendor Purchase Management (standalone) ================= */\nfunction VendorPurchaseManagement({ t }) {\n  const [vendorsSummary, setVendorsSummary] = useState([]); // [{vendorName, totalPending, totalGrand, totalPaid, purchases: []}]\n  const [selectedVendorName, setSelectedVendorName] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState(\"\");\n\n  // Load all pending purchases from backend\n  useEffect(() => {\n    loadVendorPurchases();\n  }, []);\n\n  async function loadVendorPurchases() {\n    try {\n      setLoading(true);\n      setErr(\"\");\n\n      const res = await fetch(\"http://localhost:4000/api/purchases-with-pending\");\n      const j = await res.json();\n      if (!j.ok) {\n        throw new Error(j.message || \"Failed to load vendor purchases\");\n      }\n\n      const list = j.purchases || [];\n\n      // Group by vendorName\n      const map = new Map();\n      list.forEach((p) => {\n        const name = p.vendorName || \"Unknown\";\n        if (!map.has(name)) {\n          map.set(name, {\n            vendorName: name,\n            totalPending: 0,\n            totalGrand: 0,\n            totalPaid: 0,\n            purchases: [],\n          });\n        }\n        const g = map.get(name);\n        g.totalPending += Number(p.pending || 0);\n        g.totalGrand += Number(p.grandTotal || 0);\n        g.totalPaid += Number(p.paidNow || 0);\n        g.purchases.push(p);\n      });\n\n      const groups = Array.from(map.values()).sort(\n        (a, b) => b.totalPending - a.totalPending\n      );\n\n      setVendorsSummary(groups);\n\n      // auto-select first vendor if none selected\n      if (!selectedVendorName && groups.length > 0) {\n        setSelectedVendorName(groups[0].vendorName);\n      }\n    } catch (e) {\n      console.error(e);\n      setErr(e.message || \"Failed to load vendor purchases\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleDeletePurchase(purchase) {\n    if (!purchase) return;\n    if (!window.confirm(\"Delete this purchase record?\")) return;\n\n    try {\n      const res = await fetch(\n        `http://localhost:4000/api/purchases/${purchase.id}`,\n        { method: \"DELETE\" }\n      );\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || \"Purchase not found!\");\n        return;\n      }\n\n      // Reload summary from backend so stale records disappear\n      await loadVendorPurchases();\n    } catch (e) {\n      console.error(e);\n      alert(\"Error deleting purchase\");\n    }\n  }\n\n  const selectedVendorSummary =\n    vendorsSummary.find((v) => v.vendorName === selectedVendorName) || null;\n\n  const totalPendingAll = vendorsSummary.reduce(\n    (sum, v) => sum + v.totalPending,\n    0\n  );\n\n  return (\n    <div className=\"bg-white p-4 rounded shadow mt-4\">\n      <div className=\"flex items-center mb-2\">\n        <h3 className=\"font-semibold text-sm flex-1\">\n          Vendor Purchase Management\n        </h3>\n        <button\n          onClick={loadVendorPurchases}\n          className=\"px-2 py-1 text-xs border rounded\"\n        >\n          Refresh\n        </button>\n      </div>\n\n      {loading && (\n        <p className=\"text-xs text-gray-500 mb-2\">Loading vendor purchases…</p>\n      )}\n      {err && <p className=\"text-xs text-red-600 mb-2\">{err}</p>}\n\n      {vendorsSummary.length === 0 ? (\n        <p className=\"text-xs text-gray-500\">\n          No purchases yet. Once you save purchases, you will see vendor-wise\n          summary here.\n        </p>\n      ) : (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n          {/* LEFT: Vendor list with totals */}\n          <div className=\"lg:col-span-1 border rounded p-3\">\n            <h4 className=\"font-semibold mb-2 text-xs\">\n              Vendors (total purchase & pending)\n            </h4>\n            <table className=\"w-full text-[11px]\">\n              <thead className=\"bg-gray-100\">\n                <tr>\n                  <th className=\"p-1 text-left\">Vendor</th>\n                  <th className=\"p-1 text-right\">Pending</th>\n                </tr>\n              </thead>\n              <tbody>\n                {vendorsSummary.map((v) => (\n                  <tr\n                    key={v.vendorName}\n                    className={\n                      \"border-t cursor-pointer \" +\n                      (v.vendorName === selectedVendorName\n                        ? \"bg-sky-50\"\n                        : \"\")\n                    }\n                    onClick={() => setSelectedVendorName(v.vendorName)}\n                  >\n                    <td className=\"p-1\">{v.vendorName}</td>\n                    <td className=\"p-1 text-right\">\n                      {v.totalPending.toFixed(2)}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n\n            <div className=\"mt-3 text-xs text-gray-600\">\n              <strong>Total Pending: </strong>\n              {totalPendingAll.toFixed(2)}\n            </div>\n          </div>\n\n          {/* RIGHT: Selected vendor details */}\n          <div className=\"lg:col-span-2 border rounded p-3\">\n            {!selectedVendorSummary ? (\n              <p className=\"text-xs text-gray-500\">\n                Select a vendor on the left to see full record of your\n                purchases, paid amounts, and remaining balance for that vendor.\n              </p>\n            ) : (\n              <>\n                {/* Summary header */}\n                <div className=\"flex flex-wrap justify-between mb-3 text-xs\">\n                  <div>\n                    <div className=\"font-semibold\">\n                      {selectedVendorSummary.vendorName}\n                    </div>\n                    <div className=\"text-gray-500\">\n                      Total Pending:{\" \"}\n                      <strong>\n                        {selectedVendorSummary.totalPending.toFixed(2)}\n                      </strong>\n                    </div>\n                  </div>\n                  <div className=\"text-right space-y-1\">\n                    <div>\n                      Total Grand:{\" \"}\n                      <strong>\n                        {selectedVendorSummary.totalGrand.toFixed(2)}\n                      </strong>\n                    </div>\n                    <div>\n                      Total Paid:{\" \"}\n                      <strong>\n                        {selectedVendorSummary.totalPaid.toFixed(2)}\n                      </strong>\n                    </div>\n                  </div>\n                </div>\n\n                {/* All purchases for this vendor */}\n                {selectedVendorSummary.purchases.map((p) => {\n                  const items = p.products || [];\n                  return (\n                    <div\n                      key={p.id}\n                      className=\"border rounded mb-3 p-2 text-[11px]\"\n                    >\n                      <div className=\"flex flex-wrap justify-between mb-1\">\n                        <div>\n                          <span className=\"font-semibold\">Date: </span>\n                          {p.date\n                            ? new Date(p.date).toLocaleString()\n                            : \"-\"}\n                        </div>\n                        <div>\n                          <span className=\"font-semibold\">Grand: </span>\n                          {p.grandTotal} &nbsp;|&nbsp;\n                          <span className=\"font-semibold\">Paid: </span>\n                          {p.paidNow} &nbsp;|&nbsp;\n                          <span className=\"font-semibold\">\n                            Remaining:{\" \"}\n                          </span>\n                          {p.pending}\n                        </div>\n                      </div>\n\n                      {/* Products table */}\n                      <table className=\"w-full text-[11px] border mt-1\">\n                        <thead className=\"bg-gray-100\">\n                          <tr>\n                            <th className=\"border px-1 py-0.5\">#</th>\n                            <th className=\"border px-1 py-0.5\">Product</th>\n                            <th className=\"border px-1 py-0.5\">Qty</th>\n                            <th className=\"border px-1 py-0.5\">Weight</th>\n                            <th className=\"border px-1 py-0.5\">Price</th>\n                            <th className=\"border px-1 py-0.5\">Line Total</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {items.map((it, idx) => (\n                            <tr key={idx}>\n                              <td className=\"border px-1 py-0.5\">\n                                {idx + 1}\n                              </td>\n                              <td className=\"border px-1 py-0.5\">\n                                {it.productName}\n                              </td>\n                              <td className=\"border px-1 py-0.5\">\n                                {it.qty || it.quantity}\n                              </td>\n                              <td className=\"border px-1 py-0.5\">\n                                {it.weight}\n                              </td>\n                              <td className=\"border px-1 py-0.5\">\n                                {it.pricePerKg || it.price}\n                              </td>\n                              <td className=\"border px-1 py-0.5\">\n                                {it.lineTotal}\n                              </td>\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n\n                      {/* Actions */}\n                      <div className=\"mt-2 flex justify-end gap-2\">\n                        <button\n                          onClick={() =>\n                            alert(\n                              \"Edit in form: we can wire this to Purchases later.\"\n                            )\n                          }\n                          className=\"px-2 py-1 bg-sky-600 text-white rounded\"\n                        >\n                          Edit in Form\n                        </button>\n                        <button\n                          onClick={() => handleDeletePurchase(p)}\n                          className=\"px-2 py-1 bg-red-600 text-white rounded\"\n                        >\n                          🗑 Delete\n                        </button>\n                      </div>\n                    </div>\n                  );\n                })}\n              </>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/* Purchases */\nfunction Purchases({ t }) {\n  const [vendorName, setVendorName] = useState('');\n  \n  const [rows, setRows] = useState([\n    { productName: '', qty: 1, weight: 0, pricePerKg: 0 },\n  ]);\n  const [paidNow, setPaidNow] = useState(0);\n  const [mode, setMode] = useState('cash');\n  const [records, setRecords] = useState([]);\n  const [editingIndex, setEditingIndex] = useState(null);\n  const [editingId, setEditingId] = useState(null);\n  const [filterDate, setFilterDate] = useState(''); // <-- NEW: date filter\n  const [selectedVendorName, setSelectedVendorName] = useState('');\n\n \n\n// Build a map: vendorName -> aggregated info + list of their purchases\nconst vendorMap = new Map();\n\n(records || []).forEach((r) => {\n  const name = r.vendorName || 'Unknown';\n  if (!vendorMap.has(name)) {\n    vendorMap.set(name, {\n      vendorName: name,\n      totalGrand: 0,\n      totalPaid: 0,\n      totalPending: 0,\n      purchases: [],\n    });\n  }\n  const entry = vendorMap.get(name);\n  entry.totalGrand += Number(r.grandTotal || 0);\n  entry.totalPaid += Number(r.paidNow || 0);\n  entry.totalPending += Number(r.pending || 0);\n  entry.purchases.push(r);\n});\n\n// Sorted list of vendors (by pending desc)\nconst vendorsSummary = Array.from(vendorMap.values()).sort(\n  (a, b) => b.totalPending - a.totalPending\n);\n\nconst selectedVendorSummary =\n  vendorsSummary.find((v) => v.vendorName === selectedVendorName) || null;\n\n  // ===== Persistent storage of purchases in localStorage =====\n\n  // 🔹 1) Load from localStorage on mount\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem('erp_purchases');\n      if (!raw) return;\n      const parsed = JSON.parse(raw);\n      if (Array.isArray(parsed)) {\n        setRecords(parsed);\n      }\n    } catch (e) {\n      console.error('Failed to load purchases from localStorage', e);\n    }\n  }, []);\n\n  // 🔹 2) Save to localStorage whenever records change\n  useEffect(() => {\n    try {\n      localStorage.setItem('erp_purchases', JSON.stringify(records));\n    } catch (e) {\n      console.error('Failed to save purchases to localStorage', e);\n    }\n  }, [records]);\n\n  function addRow() {\n    setRows((prev) => [\n      ...prev,\n      { productName: '', qty: 1, weight: 0, pricePerKg: 0 },\n    ]);\n  }\n\n  function updateRow(i, key, value) {\n    const a = [...rows];\n    a[i][key] = value;\n    setRows(a);\n  }\n\n  const total = rows.reduce(\n    (s, r) =>\n      s +\n      Number(r.qty || 0) *\n        Number(r.weight || 0) *\n        Number(r.pricePerKg || 0),\n    0\n  );\n  const remaining = +(total - Number(paidNow || 0)).toFixed(2);\n\n async function savePurchase() {\n  // normalize payload from form\n  const payloadProducts = rows.map(r => ({\n    productName: r.productName,\n    qty: Number(r.qty || 0),\n    weight: Number(r.weight || 0),\n    pricePerKg: Number(r.pricePerKg || 0),\n  }));\n\n  const payload = {\n    vendorName,\n    products: payloadProducts,\n    paidNow,\n    modeOfPayment: mode,\n  };\n\n  try {\n    let j;\n    if (editingIndex !== null && editingId) {\n      // UPDATE existing purchase\n      const res = await fetch(\n        `http://localhost:4000/api/purchases/${editingId}`,\n        {\n          method: 'PUT',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload),\n        }\n      );\n      j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to update purchase');\n        return;\n      }\n\n      const updated = j.record;\n      setRecords(prev =>\n        prev.map(p => (p.id === updated.id ? updated : p))\n      );\n      alert('Purchase updated');\n    } else {\n      // CREATE new purchase\n      const res = await fetch('http://localhost:4000/api/save-purchase', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to save purchase');\n        return;\n      }\n      setRecords(prev => [...prev, j.record]);\n      alert('Purchase saved');\n    }\n\n    // reset editing + form\n    setEditingIndex(null);\n    setEditingId(null);\n    setVendorName('');\n    setPaidNow(0);\n    setMode('cash');\n    setRows([{ productName: '', qty: 1, weight: 0, pricePerKg: 0 }]);\n  } catch (e) {\n    console.error(e);\n    alert('Error saving purchase');\n  }\n}\n\nfunction editPurchase(index) {\n  const r = records[index];\n  if (!r) return;\n\n  // Fill form with this purchase\n  setVendorName(r.vendorName || '');\n  setPaidNow(Number(r.paidNow || 0));\n  setMode(r.modeOfPayment || 'cash');\n\n  const restoredRows = (r.products || []).map((p) => ({\n    productName: p.productName,\n    qty: p.qty || p.quantity || 0,\n    weight: p.weight || 0,\n    pricePerKg: p.pricePerKg || p.price || 0,\n  }));\n\n  setRows(\n    restoredRows.length\n      ? restoredRows\n      : [{ productName: '', qty: 1, weight: 0, pricePerKg: 0 }]\n  );\n\n  // 🔹 these two lines are the important part:\n  setEditingIndex(index);\n  setEditingId(r.id);     \n}\n\n\n  async function deletePurchase(index) {\n  const r = records[index];\n  if (!r || !r.id) return;\n  if (!window.confirm('Delete this purchase?')) return;\n  try {\n    const res = await fetch(\n      `http://localhost:4000/api/purchases/${r.id}`,\n      { method: 'DELETE' }\n    );\n    const j = await res.json();\n    if (!j.ok) {\n      alert(j.message || 'Failed to delete purchase');\n      return;\n    }\n\n    setRecords(prev => prev.filter(x => x.id !== r.id));\n    alert('Purchase deleted');\n  } catch (e) {\n    console.error(e);\n    alert('Error deleting purchase');\n  }\n}\n\n\n  // --- Filtered records by date (yyyy-mm-dd) ---\n  const displayedRecords = filterDate\n    ? records.filter((r) => {\n        if (!r.date) return false;\n        // r.date usually ISO string: \"2025-11-15T10:30:00.000Z\"\n        return r.date.slice(0, 10) === filterDate;\n      })\n    : records;\n\n  return (\n    \n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">{t('purchases')}</h2>\n      {/* Purchase form */}\n      <div className=\"bg-white p-4 rounded shadow mb-4\">\n        <input\n          placeholder={t('vendorName')}\n          value={vendorName}\n          onChange={(e) => setVendorName(e.target.value)}\n          className=\"border p-2 w-full mb-3\"\n        />\n        \n\n        {/* Items table */}\n        <table className=\"w-full\">\n          <thead className=\"bg-sky-100\">\n            <tr>\n              <th>#</th>\n              <th>Product</th>\n              <th>Qty</th>\n              <th>Weight</th>\n              <th>Price</th>\n              <th>Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            {rows.map((r, i) => (\n              <tr key={i} className=\"border-t\">\n                <td className=\"p-2\">{i + 1}</td>\n                <td className=\"p-2\">\n                  <input\n                    className=\"border p-1\"\n                    value={r.productName}\n                    onChange={(e) =>\n                      updateRow(i, 'productName', e.target.value)\n                    }\n                  />\n                </td>\n                <td className=\"p-2\">\n                  <input\n                    className=\"border p-1 w-20\"\n                    type=\"number\"\n                    value={r.qty}\n                    onChange={(e) =>\n                      updateRow(i, 'qty', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2\">\n                  <input\n                    className=\"border p-1 w-24\"\n                    type=\"number\"\n                    value={r.weight}\n                    onChange={(e) =>\n                      updateRow(i, 'weight', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2\">\n                  <input\n                    className=\"border p-1 w-28\"\n                    type=\"number\"\n                    value={r.pricePerKg}\n                    onChange={(e) =>\n                      updateRow(i, 'pricePerKg', Number(e.target.value))\n                    }\n                  />\n                </td>\n                <td className=\"p-2\">\n                  {(\n                    Number(r.qty || 0) *\n                    Number(r.weight || 0) *\n                    Number(r.pricePerKg || 0)\n                  ).toFixed(2)}\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        {/* Controls */}\n        <div className=\"flex items-center gap-2 mt-4\">\n          <button\n            onClick={addRow}\n            className=\"px-3 py-1 border rounded hover:shadow transition\"\n          >\n            ➕ Add Item\n          </button>\n\n          <select\n            value={mode}\n            onChange={(e) => setMode(e.target.value)}\n            className=\"border p-1 rounded\"\n          >\n            <option value=\"cash\">{t('cash')}</option>\n            <option value=\"card\">{t('card')}</option>\n            <option value=\"cheque\">{t('cheque')}</option>\n            <option value=\"online\">{t('online')}</option>\n          </select>\n\n          <div className=\"ml-auto flex items-center gap-2\">\n            <label>Amount Paid</label>\n            <input\n              type=\"number\"\n              value={paidNow}\n              onChange={(e) => setPaidNow(Number(e.target.value))}\n              className=\"border p-1 w-28\"\n            />\n            <div className=\"px-3 py-2 bg-gray-50 rounded\">\n              Remaining:{' '}\n              <strong>{remaining.toFixed(2)}</strong>\n            </div>\n            <button\n              onClick={savePurchase}\n              className=\"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 transition\"\n            >\n              {editingIndex !== null ? 'Update Purchase' : 'Save Purchase'}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Vendor Purchase Management */}\n        <VendorPurchaseManagement t={t} />\n\n    </div>\n  );\n}\n\nasync function loadPurchases() {\n  try {\n    const res = await fetch('http://localhost:4000/api/purchases');\n    const j = await res.json();\n    if (!j.ok) {\n      console.error(j.message || 'Failed to load purchases');\n      return;\n    }\n    setRecords(j.purchases || []);\n  } catch (e) {\n    console.error('Error loading purchases', e);\n  }\n}\n\n/* Reports / Debits placeholders */\nfunction Reports({ t }) {\n  const [date, setDate] = useState(() => new Date().toISOString().slice(0, 10));\n  const [report, setReport] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState('');\n\n  async function loadReport(e) {\n    if (e && e.preventDefault) e.preventDefault();\n    if (!date) {\n      alert('Select a date');\n      return;\n    }\n    setLoading(true);\n    setErr('');\n    setReport(null);\n    try {\n      const res = await fetch(`http://localhost:4000/api/reports/day?date=${date}`);\n      const j = await res.json();\n      if (!j.ok) throw new Error(j.message || 'Failed to load report');\n      setReport(j);\n    } catch (e) {\n      console.error(e);\n      setErr('Failed to load report');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Optional: auto-load for today on first open\n  // useEffect(() => { loadReport(); }, []);\n\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">Reports</h2>\n\n      {/* Date filter */}\n      <div className=\"bg-white p-4 rounded shadow mb-4\">\n        <form onSubmit={loadReport} className=\"flex flex-wrap items-end gap-4\">\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Select Date</label>\n            <input\n              type=\"date\"\n              value={date}\n              onChange={e => setDate(e.target.value)}\n              className=\"border p-2 rounded\"\n            />\n          </div>\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 bg-sky-600 text-white rounded hover:bg-sky-700 transition\"\n          >\n            {loading ? 'Loading…' : 'Load Report'}\n          </button>\n          {err && <span className=\"text-red-600 text-sm ml-2\">{err}</span>}\n        </form>\n      </div>\n\n      {/* If no report yet */}\n      {!report && !loading && !err && (\n        <p className=\"text-sm text-gray-600\">Select a date and click \"Load Report\" to view details.</p>\n      )}\n\n      {/* Summary + details once we have data */}\n      {report && (\n        <>\n          {/* Summary cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\n            <div className=\"bg-white p-4 rounded shadow\">\n              <div className=\"text-sm text-gray-500\">Total Sales</div>\n              <div className=\"text-xl font-semibold\">\n                 {Number(report.totalSales || 0).toFixed(2)}\n              </div>\n            </div>\n            <div className=\"bg-white p-4 rounded shadow\">\n              <div className=\"text-sm text-gray-500\">Amount Received</div>\n              <div className=\"text-xl font-semibold\">\n                {Number(report.totalReceived || 0).toFixed(2)}\n              </div>\n            </div>\n            <div className=\"bg-white p-4 rounded shadow\">\n              <div className=\"text-sm text-gray-500\">Number of Bills</div>\n              <div className=\"text-xl font-semibold\">\n                {(report.invoices || []).length}\n              </div>\n            </div>\n          </div>\n\n          {/* Products sold summary */}\n          <div className=\"bg-white p-4 rounded shadow mb-4\">\n            <h3 className=\"font-semibold mb-2\">Products Sold on {report.date}</h3>\n            {(report.productsSummary || []).length === 0 ? (\n              <p className=\"text-sm text-gray-500\">No products sold on this date.</p>\n            ) : (\n              <table className=\"w-full text-sm border\">\n                <thead className=\"bg-gray-100\">\n                  <tr>\n                    <th className=\"border px-2 py-1 text-left\">Product</th>\n                    <th className=\"border px-2 py-1 text-right\">Total Qty</th>\n                    <th className=\"border px-2 py-1 text-right\">Total Weight</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {report.productsSummary.map((p, i) => (\n                    <tr key={i}>\n                      <td className=\"border px-2 py-1\">{p.productName}</td>\n                      <td className=\"border px-2 py-1 text-right\">{p.totalQty}</td>\n                      <td className=\"border px-2 py-1 text-right\">{p.totalWeight}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n\n          {/* All bills with full details */}\n          <div className=\"bg-white p-4 rounded shadow\">\n            <h3 className=\"font-semibold mb-2\">Bills / Invoices</h3>\n            {(report.invoices || []).length === 0 && (\n              <p className=\"text-sm text-gray-500\">No invoices on this date.</p>\n            )}\n            {(report.invoices || []).map(inv => (\n              <div key={inv.id} className=\"border rounded mb-4 p-3\">\n                <div className=\"flex flex-wrap justify-between text-sm mb-1\">\n                  <div>\n                    <span className=\"font-semibold\">Customer: </span>\n                    {inv.customerName}\n                  </div>\n                  <div>\n                    <span className=\"font-semibold\">Time: </span>\n                    {inv.date}\n                  </div>\n                </div>\n                <div className=\"flex flex-wrap gap-4 text-sm mb-2\">\n                  <div>Grand Total: {inv.grandTotal}</div>\n                  <div>Paid: {inv.paidNow}</div>\n                  <div>Pending:  {inv.pending}</div>\n                </div>\n                <table className=\"w-full text-xs border\">\n                  <thead className=\"bg-gray-100\">\n                    <tr>\n                      <th className=\"border px-1 py-0.5\">#</th>\n                      <th className=\"border px-1 py-0.5\">Product</th>\n                      <th className=\"border px-1 py-0.5\">Qty</th>\n                      <th className=\"border px-1 py-0.5\">Weight</th>\n                      <th className=\"border px-1 py-0.5\">Price</th>\n                      <th className=\"border px-1 py-0.5\">Line Total</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {(inv.products || inv.lines || []).map((p, idx) => (\n                      <tr key={idx}>\n                        <td className=\"border px-1 py-0.5\">{idx + 1}</td>\n                        <td className=\"border px-1 py-0.5\">{p.productName}</td>\n                        <td className=\"border px-1 py-0.5\">{p.quantity || p.qty}</td>\n                        <td className=\"border px-1 py-0.5\">{p.weight}</td>\n                        <td className=\"border px-1 py-0.5\">{p.pricePerKg || p.price}</td>\n                        <td className=\"border px-1 py-0.5\">{p.lineTotal}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n/*Debits*/\nfunction Debits({ t }) {\n  const [vendors, setVendors] = useState([]);\n  const [selectedVendorId, setSelectedVendorId] = useState('');\n\n  // Add / edit vendor form\n  const [vendorName, setVendorName] = useState('');\n  const [vendorPlace, setVendorPlace] = useState('');\n  const [vendorCompany, setVendorCompany] = useState('');\n  const [editingVendorId, setEditingVendorId] = useState(null);\n\n  // Ledger & transaction form\n  const [ledger, setLedger] = useState([]);\n  const [txType, setTxType] = useState('received'); // 'received' | 'paid' | 'goods'\n  const [txAmount, setTxAmount] = useState(0);\n  const [txMethod, setTxMethod] = useState('');\n  const [txBillRef, setTxBillRef] = useState('');\n  const [txDate, setTxDate] = useState('');\n  const [editingTxId, setEditingTxId] = useState(null);\n\n  // Purchases with pending (Purchased Vendor section)\n  const [purchaseDebits, setPurchaseDebits] = useState([]);\n  const [loadingPurchases, setLoadingPurchases] = useState(false);\n\n  useEffect(() => {\n    loadVendors();\n    loadPurchaseDebits();\n  }, []);\n\n  async function loadVendors() {\n    try {\n      const res = await fetch('http://localhost:4000/api/vendors');\n      const j = await res.json();\n      if (j.ok) setVendors(j.vendors || []);\n    } catch (e) {\n      console.error('Failed to load vendors', e);\n    }\n  }\n\n  async function loadLedger(vendorId) {\n    if (!vendorId) {\n      setLedger([]);\n      return;\n    }\n    try {\n      const res = await fetch(`http://localhost:4000/api/vendors/${vendorId}/ledger`);\n      const j = await res.json();\n      if (j.ok) {\n        setLedger(j.ledger || []);\n        // update vendors list with new remaining\n        setVendors(prev =>\n          prev.map(v => (v.id === vendorId ? j.vendor : v))\n        );\n      }\n    } catch (e) {\n      console.error('Failed to load ledger', e);\n    }\n  }\n\n  async function loadPurchaseDebits() {\n    try {\n      setLoadingPurchases(true);\n      const res = await fetch('http://localhost:4000/api/purchases-with-pending');\n      const j = await res.json();\n      if (j.ok) setPurchaseDebits(j.purchases || []);\n    } catch (e) {\n      console.error('Failed to load purchase debits', e);\n    } finally {\n      setLoadingPurchases(false);\n    }\n  }\n\n  function onSelectVendor(id) {\n    setSelectedVendorId(id);\n    setEditingTxId(null);\n    resetTxForm();\n    if (id) loadLedger(id);\n    else setLedger([]);\n  }\n\n  // --- Vendor form helpers ---\n  function startNewVendor() {\n    setVendorName('');\n    setVendorPlace('');\n    setVendorCompany('');\n    setEditingVendorId(null);\n  }\n\n  function startEditVendor(vendor) {\n    setVendorName(vendor.name || '');\n    setVendorPlace(vendor.place || '');\n    setVendorCompany(vendor.company || '');\n    setEditingVendorId(vendor.id);\n  }\n\n  async function saveVendor() {\n    if (!vendorName) {\n      alert('Vendor name is required');\n      return;\n    }\n\n    const payload = {\n      id: editingVendorId || undefined,\n      name: vendorName,\n      place: vendorPlace,\n      company: vendorCompany,\n    };\n\n    try {\n      const res = await fetch('http://localhost:4000/api/vendors', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to save vendor');\n        return;\n      }\n\n      const v = j.vendor;\n      setVendors(prev => {\n        const idx = prev.findIndex(x => x.id === v.id);\n        if (idx === -1) return [...prev, v];\n        const copy = [...prev];\n        copy[idx] = v;\n        return copy;\n      });\n\n      setVendorName('');\n      setVendorPlace('');\n      setVendorCompany('');\n      setEditingVendorId(null);\n    } catch (e) {\n      console.error(e);\n      alert('Error saving vendor');\n    }\n  }\n\n  async function deleteVendor(vendor) {\n    if (!window.confirm(`Delete vendor \"${vendor.name}\" and all its debits?`)) return;\n    try {\n      const res = await fetch(`http://localhost:4000/api/vendors/${vendor.id}`, {\n        method: 'DELETE',\n      });\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to delete vendor');\n        return;\n      }\n      setVendors(prev => prev.filter(v => v.id !== vendor.id));\n      if (selectedVendorId === vendor.id) {\n        setSelectedVendorId('');\n        setLedger([]);\n      }\n    } catch (e) {\n      console.error(e);\n      alert('Error deleting vendor');\n    }\n  }\nasync function deletePurchaseDebit(p) {\n  if (!p || !p.id) return;\n  if (!window.confirm('Delete this pending purchase?')) return;\n\n  try {\n    const res = await fetch(\n      `http://localhost:4000/api/purchases/${p.id}`,\n      { method: 'DELETE' }\n    );\n    const j = await res.json();\n    if (!j.ok) {\n      alert(j.message || 'Failed to delete purchase');\n      return;\n    }\n\n    // remove from local pending list\n    setPurchaseDebits(prev => prev.filter(x => x.id !== p.id));\n    alert('Purchase deleted');\n  } catch (e) {\n    console.error(e);\n    alert('Error deleting purchase');\n  }\n}\n\n  // --- Transaction form helpers ---\n  function resetTxForm() {\n    setTxType('received');\n    setTxAmount(0);\n    setTxMethod('');\n    setTxBillRef('');\n    setTxDate('');\n    setEditingTxId(null);\n  }\n\n  function startEditTx(tx) {\n    setTxType(tx.type);\n    setTxAmount(tx.amount);\n    setTxMethod(tx.method || '');\n    setTxBillRef(tx.billRef || '');\n    setTxDate(tx.date ? tx.date.slice(0, 10) : '');\n    setEditingTxId(tx.id);\n  }\n\n  async function saveTransaction() {\n    if (!selectedVendorId) {\n      alert('Select a vendor first');\n      return;\n    }\n    if (!txAmount || Number(txAmount) <= 0) {\n      alert('Amount must be greater than 0');\n      return;\n    }\n\n    const payload = {\n      type: txType,                            // 'received' | 'paid' | 'goods'\n      amount: Number(txAmount),\n      method: txMethod,\n      billRef: txBillRef,\n      date: txDate ? new Date(txDate).toISOString() : undefined,\n    };\n\n    try {\n      let url = `http://localhost:4000/api/vendors/${selectedVendorId}/transactions`;\n      let method = 'POST';\n\n      if (editingTxId) {\n        url += `/${editingTxId}`;\n        method = 'PUT';\n      }\n\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to save transaction');\n        return;\n      }\n\n      setLedger(j.ledger || []);\n      setVendors(prev =>\n        prev.map(v => (v.id === selectedVendorId ? j.vendor : v))\n      );\n      resetTxForm();\n    } catch (e) {\n      console.error(e);\n      alert('Error saving transaction');\n    }\n  }\n\n  async function deleteTransaction(tx) {\n    if (!selectedVendorId) return;\n    if (!window.confirm('Delete this transaction?')) return;\n    try {\n      const res = await fetch(\n        `http://localhost:4000/api/vendors/${selectedVendorId}/transactions/${tx.id}`,\n        { method: 'DELETE' }\n      );\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to delete');\n        return;\n      }\n      setLedger(j.ledger || []);\n      setVendors(prev =>\n        prev.map(v => (v.id === selectedVendorId ? j.vendor : v))\n      );\n    } catch (e) {\n      console.error(e);\n      alert('Error deleting transaction');\n    }\n  }\n\n  // --- Edit/Delete purchase debits (Pending purchases) ---\n  async function editPurchaseDebit(p) {\n  if (!p || !p.id) return;\n\n  // Ask how much is paid now (or you can design a better UI later)\n  const newPaidStr = prompt(\n    'Enter new paid amount for this purchase:',\n    String(p.paidNow || 0)\n  );\n  if (newPaidStr === null) return; // cancelled\n  const newPaid = Number(newPaidStr);\n  if (isNaN(newPaid)) {\n    alert('Invalid amount');\n    return;\n  }\n\n  const payload = {\n    vendorName: p.vendorName,\n    products: p.products || [],\n    paidNow: newPaid,\n    modeOfPayment: p.modeOfPayment,\n  };\n\n  try {\n    const res = await fetch(\n      `http://localhost:4000/api/purchases/${p.id}`,\n      {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      }\n    );\n    const j = await res.json();\n    if (!j.ok) {\n      alert(j.message || 'Failed to update purchase');\n      return;\n    }\n\n    const updated = j.record;\n\n    // Update local pending list\n    setPurchaseDebits((prev) => {\n      const arr = prev\n        .map((x) => (x.id === updated.id ? updated : x))\n        // if pending <= 0, remove from \"pending\" list\n        .filter((x) => Number(x.pending || 0) > 0);\n      return arr;\n    });\n\n    alert('Purchase updated');\n\n  } catch (e) {\n    console.error(e);\n    alert('Error updating purchase');\n  }\n}\n\n\n  async function deletePurchase(index) {\n  const rec = records[index];\n  if (!rec) return;\n\n  if (!window.confirm('Delete this purchase?')) return;\n\n  try {\n    // tell backend to delete it\n    const res = await fetch(\n      `http://localhost:4000/api/purchases/${rec.id}`,\n      { method: 'DELETE' }\n    );\n    const j = await res.json();\n    if (!j.ok) {\n      alert(j.message || 'Failed to delete purchase');\n      return;\n    }\n\n    // remove from local list\n    setRecords(prev => prev.filter(r => r.id !== rec.id));\n\n    // if you’re editing this one, reset edit state\n    setEditingIndex(null);\n    alert('Purchase deleted');\n  } catch (e) {\n    console.error(e);\n    alert('Error deleting purchase');\n  }\n}\n\n\n  // --- Ledger summary ---\n  const totalReceived = ledger\n    .filter(tx => tx.type === 'received')\n    .reduce((s, tx) => s + Number(tx.amount || 0), 0);\n\n  const totalPaid = ledger\n    .filter(tx => tx.type === 'paid')\n    .reduce((s, tx) => s + Number(tx.amount || 0), 0);\n\n  const totalGoods = ledger\n    .filter(tx => tx.type === 'goods')\n    .reduce((s, tx) => s + Number(tx.amount || 0), 0);\n\n  const remaining =\n    (vendors.find(v => v.id === selectedVendorId)?.remaining ?? 0);\n\n  const selectedVendor = vendors.find(v => v.id === selectedVendorId) || null;\n\n  // Purchases filtered by selected vendor (if any)\n  const filteredPurchases = selectedVendor\n    ? purchaseDebits.filter(p =>\n        (p.vendorName || '').toLowerCase() ===\n        (selectedVendor.name || '').toLowerCase()\n      )\n    : purchaseDebits;\n\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">Debits</h2>\n\n      {/* MAIN GRID: Vendor Debit Management */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6\">\n        {/* LEFT: Vendor Add/Edit + List */}\n        <div className=\"lg:col-span-1 space-y-4\">\n          <div className=\"bg-white p-4 rounded shadow\">\n            <h3 className=\"font-semibold mb-3\">Vendor Debit Management</h3>\n            <div className=\"space-y-2 text-sm\">\n              <input\n                className=\"border p-2 rounded w-full\"\n                placeholder=\"Vendor Name\"\n                value={vendorName}\n                onChange={e => setVendorName(e.target.value)}\n              />\n              <input\n                className=\"border p-2 rounded w-full\"\n                placeholder=\"Place / Location\"\n                value={vendorPlace}\n                onChange={e => setVendorPlace(e.target.value)}\n              />\n              <input\n                className=\"border p-2 rounded w-full\"\n                placeholder=\"Company Name\"\n                value={vendorCompany}\n                onChange={e => setVendorCompany(e.target.value)}\n              />\n              <div className=\"flex gap-2 mt-2\">\n                <button\n                  onClick={saveVendor}\n                  className=\"px-3 py-1 bg-teal-600 text-white rounded hover:bg-teal-700 text-sm\"\n                >\n                  {editingVendorId ? 'Update Vendor' : 'Save Vendor'}\n                </button>\n                <button\n                  onClick={startNewVendor}\n                  className=\"px-3 py-1 border rounded text-sm\"\n                >\n                  New\n                </button>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white p-4 rounded shadow max-h-[400px] overflow-auto\">\n            <h3 className=\"font-semibold mb-3\">Vendors</h3>\n            {vendors.length === 0 ? (\n              <p className=\"text-xs text-gray-500\">No vendors yet.</p>\n            ) : (\n              <table className=\"w-full text-xs\">\n                <thead className=\"bg-gray-100\">\n                  <tr>\n                    <th className=\"p-2 text-left\">Name</th>\n                    <th className=\"p-2 text-right\">Remaining</th>\n                    <th className=\"p-2 text-center\">Action</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {vendors.map(v => (\n                    <tr\n                      key={v.id}\n                      className={\n                        'border-t ' +\n                        (v.id === selectedVendorId ? 'bg-sky-50' : '')\n                      }\n                    >\n                      <td className=\"p-2\">\n                        <button\n                          onClick={() => onSelectVendor(v.id)}\n                          className=\"text-left text-xs hover:underline\"\n                        >\n                          {v.name}\n                          {v.company ? ` (${v.company})` : ''}\n                        </button>\n                      </td>\n                      <td className=\"p-2 text-right\">\n                        {Number(v.remaining || 0).toFixed(2)}\n                      </td>\n                      <td className=\"p-2 text-center\">\n                        <button\n                          onClick={() => startEditVendor(v)}\n                          className=\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\"\n                        >\n                          Edit\n                        </button>\n                          <button\n                            onClick={() => deleteVendor(v)}\n                            className=\"px-2 py-1 text-xs bg-red-600 text-white rounded\"\n                          >\n                            🗑\n                          </button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </div>\n\n        {/* RIGHT: Ledger & Transactions */}\n        <div className=\"lg:col-span-2 space-y-4\">\n          <div className=\"bg-white p-4 rounded shadow\">\n            <h3 className=\"font-semibold mb-3\">\n              {selectedVendorId ? 'Vendor Ledger' : 'Select a Vendor'}\n            </h3>\n\n            {selectedVendorId && (\n              <>\n                {/* Summary */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 text-sm\">\n                  <div className=\"bg-sky-50 p-2 rounded\">\n                    <div className=\"text-xs text-gray-500\">Total Received</div>\n                    <div className=\"font-semibold\">\n                      {totalReceived.toFixed(2)}\n                    </div>\n                  </div>\n                  <div className=\"bg-sky-50 p-2 rounded\">\n                    <div className=\"text-xs text-gray-500\">Total Paid</div>\n                    <div className=\"font-semibold\">\n                      {totalPaid.toFixed(2)}\n                    </div>\n                  </div>\n                  <div className=\"bg-sky-50 p-2 rounded\">\n                    <div className=\"text-xs text-gray-500\">Goods Purchased</div>\n                    <div className=\"font-semibold\">\n                      {totalGoods.toFixed(2)}\n                    </div>\n                  </div>\n                  <div className=\"bg-sky-50 p-2 rounded\">\n                    <div className=\"text-xs text-gray-500\">Remaining</div>\n                    <div className=\"font-semibold\">\n                      {Number(remaining || 0).toFixed(2)}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Add/Edit Transaction */}\n                <div className=\"border rounded p-3 mb-4 text-sm\">\n                  <h4 className=\"font-semibold mb-2\">\n                    {editingTxId ? 'Edit Transaction' : 'Add Transaction'}\n                  </h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-5 gap-2\">\n                    <select\n                      className=\"border p-2 rounded\"\n                      value={txType}\n                      onChange={e => setTxType(e.target.value)}\n                    >\n                      <option value=\"received\">Received from Vendor</option>\n                      <option value=\"paid\">Paid to Vendor</option>\n                      <option value=\"goods\">\n                        Goods Purchased (vendor takes goods)\n                      </option>\n                    </select>\n                    <input\n                      type=\"number\"\n                      className=\"border p-2 rounded\"\n                      placeholder=\"Amount\"\n                      value={txAmount}\n                      onChange={e => setTxAmount(e.target.value)}\n                    />\n                    <input\n                      type=\"date\"\n                      className=\"border p-2 rounded\"\n                      value={txDate}\n                      onChange={e => setTxDate(e.target.value)}\n                    />\n                    <input\n                      className=\"border p-2 rounded\"\n                      placeholder=\"Payment Method\"\n                      value={txMethod}\n                      onChange={e => setTxMethod(e.target.value)}\n                    />\n                    <input\n                      className=\"border p-2 rounded\"\n                      placeholder=\"Remarks\"\n                      value={txBillRef}\n                      onChange={e => setTxBillRef(e.target.value)}\n                    />\n                  </div>\n                  <div className=\"flex gap-2 mt-3\">\n                    <button\n                      onClick={saveTransaction}\n                      className=\"px-3 py-1 bg-teal-600 text-white rounded text-sm\"\n                    >\n                      {editingTxId ? 'Update Transaction' : 'Save Transaction'}\n                    </button>\n                    <button\n                      onClick={resetTxForm}\n                      className=\"px-3 py-1 border rounded text-sm\"\n                    >\n                      Clear\n                    </button>\n                  </div>\n                </div>\n\n                {/* Ledger Table */}\n                <div className=\"max-h-[380px] overflow-auto text-xs\">\n                  <table className=\"w-full\">\n                    <thead className=\"bg-gray-100\">\n                      <tr>\n                        <th className=\"p-2 text-left\">Date</th>\n                        <th className=\"p-2 text-left\">Type</th>\n                        <th className=\"p-2 text-right\">Amount</th>\n                        <th className=\"p-2 text-left\">Method</th>\n                        <th className=\"p-2 text-left\">Remarks</th>\n                        <th className=\"p-2 text-right\">Balance After</th>\n                        <th className=\"p-2 text-center\">Actions</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {ledger.map(tx => (\n                        <tr key={tx.id} className=\"border-t\">\n                          <td className=\"p-2\">\n                            {tx.date\n                              ? new Date(tx.date).toLocaleDateString()\n                              : '-'}\n                          </td>\n                          <td className=\"p-2 capitalize\">{tx.type}</td>\n                          <td className=\"p-2 text-right\">\n                            {Number(tx.amount || 0).toFixed(2)}\n                          </td>\n                          <td className=\"p-2\">{tx.method}</td>\n                          <td className=\"p-2\">{tx.billRef}</td>\n                          <td className=\"p-2 text-right\">\n                            {Number(tx.balanceAfter || 0).toFixed(2)}\n                          </td>\n                          <td className=\"p-2 text-center\">\n                            <button\n                              onClick={() => startEditTx(tx)}\n                              className=\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\"\n                            >\n                              Edit\n                            </button>\n                            <button\n                              onClick={() => deleteTransaction(tx)}\n                              className=\"px-2 py-1 text-xs bg-red-600 text-white rounded\"\n                            >\n                              🗑\n                            </button>\n                          </td>\n                        </tr>\n                      ))}\n                      {ledger.length === 0 && (\n                        <tr>\n                          <td\n                            colSpan={7}\n                            className=\"p-2 text-center text-gray-500\"\n                          >\n                            No transactions yet.\n                          </td>\n                        </tr>\n                      )}\n                    </tbody>\n                  </table>\n                </div>\n              </>\n            )}\n\n            {!selectedVendorId && (\n              <p className=\"text-xs text-gray-500\">\n                Select a vendor on the left to view and manage their debits.\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* SECOND SECTION: PURCHASED VENDOR (Pending purchases) */}\n      <div className=\"bg-white p-4 rounded shadow\">\n        <div className=\"flex items-center mb-3\">\n          <h3 className=\"font-semibold\">Purchased Vendor (Pending Purchases)</h3>\n          <button\n            onClick={loadPurchaseDebits}\n            className=\"ml-auto px-3 py-1 text-xs border rounded\"\n          >\n            {loadingPurchases ? 'Refreshing…' : 'Refresh'}\n          </button>\n        </div>\n        <p className=\"text-xs text-gray-500 mb-2\">\n          Showing all purchases where some amount is still pending.\n          {selectedVendor\n            ? ` (Filtered by vendor: ${selectedVendor.name})`\n            : ' (All vendors)'}\n        </p>\n<table className=\"w-full text-xs\">\n  <thead className=\"bg-gray-100\">\n    <tr>\n      <th className=\"p-2 text-left\">Vendor</th>\n      <th className=\"p-2 text-left\">Date</th>\n      <th className=\"p-2 text-left\">Product</th>\n      <th className=\"p-2 text-right\">Qty</th>\n      <th className=\"p-2 text-right\">Grand Total</th>\n      <th className=\"p-2 text-right\">Paid</th>\n      <th className=\"p-2 text-right\">Remaining</th>\n      <th className=\"p-2 text-left\">Mode</th>\n      <th className=\"p-2 text-center\">Actions</th>\n    </tr>\n  </thead>\n  <tbody>\n    {filteredPurchases.map(p => {\n      const productsList = (p.products || []).map(x => x.productName).join(', ');\n      const totalQty = (p.products || []).reduce(\n        (s, x) => s + Number(x.qty || x.quantity || 0),\n        0\n      );\n      return (\n        <tr key={p.id} className=\"border-t\">\n          <td className=\"p-2\">{p.vendorName}</td>\n          <td className=\"p-2\">\n            {p.date ? new Date(p.date).toLocaleDateString() : '-'}\n          </td>\n          <td className=\"p-2\">{productsList || '-'}</td>\n          <td className=\"p-2 text-right\">{totalQty}</td>\n          <td className=\"p-2 text-right\">\n            {Number(p.grandTotal || 0).toFixed(2)}\n          </td>\n          <td className=\"p-2 text-right\">\n            {Number(p.paidNow || 0).toFixed(2)}\n          </td>\n          <td className=\"p-2 text-right\">\n            {Number(p.pending || 0).toFixed(2)}\n          </td>\n          <td className=\"p-2\">{p.modeOfPayment}</td>\n          <td className=\"p-2 text-center\">\n            <button\n              onClick={() => editPurchaseDebit(p)}\n              className=\"px-2 py-1 text-xs bg-sky-600 text-white rounded mr-1\"\n            >\n              Edit\n            </button>\n            <button\n              onClick={() => deletePurchaseDebit(p)}\n              className=\"px-2 py-1 text-xs bg-red-600 text-white rounded\"\n            >\n              🗑\n            </button>\n          </td>\n        </tr>\n      );\n    })}\n    {filteredPurchases.length === 0 && (\n      <tr>\n        <td\n          className=\"p-2 text-center text-gray-500\"\n          colSpan={9}\n        >\n          No pending purchases found.\n        </td>\n      </tr>\n    )}\n  </tbody>\n</table>\n\n      </div>\n    </div>\n  );\n}\n\nfunction RecycleBin({ t }) {\n  const [activeType, setActiveType] = useState('sales'); // 'sales' | 'purchases' | 'vendors' | 'customers'\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [err, setErr] = useState('');\n\n  async function loadItems(type = activeType) {\n    try {\n      setLoading(true);\n      setErr('');\n      const res = await fetch(`http://localhost:4000/api/recycle-bin/${type}`);\n      const j = await res.json();\n      if (!j.ok) throw new Error(j.message || 'Failed to load recycle bin');\n      setItems(j.items || []);\n    } catch (e) {\n      console.error(e);\n      setErr(e.message || 'Failed to load recycle bin');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    loadItems('sales');\n  }, []);\n\n  function changeType(type) {\n    setActiveType(type);\n    loadItems(type);\n  }\n\n  async function handleRestore(id) {\n    if (!window.confirm('Restore this record?')) return;\n    try {\n      const res = await fetch('http://localhost:4000/api/recycle-bin/restore', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ type: activeType, id }),\n      });\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to restore');\n        return;\n      }\n      await loadItems();\n      alert('Restored successfully');\n    } catch (e) {\n      console.error(e);\n      alert('Error restoring item');\n    }\n  }\n\n  async function handleDelete(id) {\n    if (!window.confirm('Permanently delete this item?')) return;\n    try {\n      const res = await fetch(\n        `http://localhost:4000/api/recycle-bin/${activeType}/${id}`,\n        { method: 'DELETE' }\n      );\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to delete from recycle bin');\n        return;\n      }\n      await loadItems();\n    } catch (e) {\n      console.error(e);\n      alert('Error deleting item');\n    }\n  }\n\n  async function handleDeleteAll() {\n    if (\n      !window.confirm(\n        `Permanently delete ALL ${activeType} items from recycle bin?`\n      )\n    )\n      return;\n    try {\n      const res = await fetch(\n        `http://localhost:4000/api/recycle-bin/${activeType}`,\n        { method: 'DELETE' }\n      );\n      const j = await res.json();\n      if (!j.ok) {\n        alert(j.message || 'Failed to delete all');\n        return;\n      }\n      await loadItems();\n    } catch (e) {\n      console.error(e);\n      alert('Error deleting all items');\n    }\n  }\n\n  // small helper to show a label per item\n  function renderMainLabel(item) {\n    if (activeType === 'sales') {\n      return `${item.customerName || 'Unknown'} — Grand: ${\n        item.grandTotal\n      } | Pending: ${item.pending}`;\n    }\n    if (activeType === 'purchases') {\n      return `${item.vendorName || 'Unknown'} — Grand: ${\n        item.grandTotal\n      } | Pending: ${item.pending}`;\n    }\n    if (activeType === 'vendors') {\n      return `${item.name || 'Vendor'} — Remaining: ${item.remaining || 0}`;\n    }\n    if (activeType === 'customers') {\n      return `${item.name || 'Customer'} — Pending: ${\n        item.previousPending || 0\n      }`;\n    }\n    return 'Item';\n  }\n\n  function formatDate(iso) {\n    if (!iso) return '';\n    try {\n      return new Date(iso).toLocaleString();\n    } catch {\n      return iso;\n    }\n  }\n\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">Recycle Bin</h2>\n\n      {/* Type tabs */}\n      <div className=\"flex gap-2 mb-4\">\n        {['sales', 'purchases', 'vendors', 'customers'].map((type) => (\n          <button\n            key={type}\n            onClick={() => changeType(type)}\n            className={\n              'px-3 py-1 rounded text-sm ' +\n              (activeType === type\n                ? 'bg-sky-600 text-white'\n                : 'bg-white text-sky-700 border')\n            }\n          >\n            {type.charAt(0).toUpperCase() + type.slice(1)}\n          </button>\n        ))}\n\n        <button\n          onClick={() => loadItems()}\n          className=\"ml-auto px-3 py-1 text-xs bg-gray-100 border rounded hover:bg-gray-200\"\n        >\n          Refresh\n        </button>\n        <button\n          onClick={handleDeleteAll}\n          className=\"px-3 py-1 text-xs bg-red-100 text-red-700 border border-red-300 rounded hover:bg-red-200\"\n        >\n          Delete All Permanently\n        </button>\n      </div>\n\n      {loading && (\n        <p className=\"text-sm text-gray-500 mb-2\">Loading recycle bin…</p>\n      )}\n      {err && <p className=\"text-sm text-red-600 mb-2\">{err}</p>}\n\n      {items.length === 0 ? (\n        <p className=\"text-sm text-gray-500\">\n          No deleted {activeType} records in recycle bin.\n        </p>\n      ) : (\n        <div className=\"bg-white rounded shadow divide-y\">\n          {items.map((item) => (\n            <div\n              key={item.id}\n              className=\"p-3 flex flex-wrap justify-between items-center text-sm\"\n            >\n              <div className=\"space-y-0.5\">\n                <div className=\"font-medium\">{renderMainLabel(item)}</div>\n                <div className=\"text-xs text-gray-500\">\n                  ID: {item.id}{' '}\n                  {item.date && <>| Date: {formatDate(item.date)}</>}\n                  {item.deletedAt && (\n                    <>\n                      {' '}\n                      | Deleted:{' '}\n                      {formatDate(item.deletedAt)}\n                    </>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex gap-2 mt-1 sm:mt-0\">\n                <button\n                  onClick={() => handleRestore(item.id)}\n                  className=\"px-2 py-1 text-xs bg-emerald-600 text-white rounded\"\n                >\n                  Restore\n                </button>\n                <button\n                  onClick={() => handleDelete(item.id)}\n                  className=\"px-2 py-1 text-xs bg-red-600 text-white rounded\"\n                >\n                  Delete\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\n\n/* Settings */\nfunction Settings({ t, onLogoChange }){\n  const [logoData, setLogoData] = useState(localStorage.getItem('erp_logo')||'');\n  function upload(e){ const f = e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ev => { setLogoData(ev.target.result); onLogoChange(ev.target.result); }; reader.readAsDataURL(f); }\n  return (\n    <div>\n      <h2 className=\"text-2xl font-semibold mb-4\">{t('settings')}</h2>\n      <div className=\"bg-white p-4 rounded shadow\">\n        <label>Upload Logo (PNG/JPG)</label>\n        <input type=\"file\" accept=\"image/*\" onChange={upload} className=\"mt-2\" />\n        {logoData && <div className=\"mt-4\"><img src={logoData} className=\"h-28\" alt=\"logo\" /></div>}\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}